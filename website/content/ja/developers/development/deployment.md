# Qwen Code の実行とデプロイ

このドキュメントでは、Qwen Code を実行する方法と、Qwen Code が使用するデプロイアーキテクチャについて説明します。

## Qwen Code の実行

Qwen Code を実行するにはいくつかの方法があります。選択肢は、どのように使うかによって異なります。

---

### 1. 標準インストール（一般ユーザーに推奨）

これは、エンドユーザーが Qwen Code をインストールするための推奨方法です。NPM レジストリから Qwen Code パッケージをダウンロードすることになります。

- **グローバルインストール:**

  ```bash
  npm install -g @qwen-code/qwen-code
  ```

  その後、どこからでも CLI を実行できます：

  ```bash
  qwen
  ```

- **NPX による実行:**

  ```bash
  # グローバルインストールせずに NPM から最新バージョンを実行
  npx @qwen-code/qwen-code
  ```

---

### 2. サンドボックス内での実行 (Docker/Podman)

セキュリティと分離のため、Qwen Code はコンテナ内で実行できます。これは、副作用がある可能性のあるツールを CLI が実行する際のデフォルトの方法です。

- **レジストリから直接実行:**
  公開されたサンドボックスイメージを直接実行できます。Docker のみが利用可能で CLI を実行したい環境に便利です。
  ```bash
  # 公開されたサンドボックスイメージを実行
  docker run --rm -it ghcr.io/qwenlm/qwen-code:0.0.11
  ```
- **`--sandbox` フラグを使用:**
  Qwen Code をローカルにインストール済みの場合（上記の標準インストール手順を使用）、サンドボックスコンテナ内で実行するように指示できます。
  ```bash
  qwen --sandbox -y -p "ここにプロンプトを入力"
  ```

---

### 3. ソースからの実行（Qwen Code コントリビューター向け推奨）

プロジェクトのコントリビューターは、CLI をソースコードから直接実行することを希望するでしょう。

- **開発モード：**
  この方法ではホットリロードが提供され、アクティブな開発に役立ちます。
  ```bash
  # リポジトリのルートから
  npm run start
  ```
- **本番環境風モード（リンクされたパッケージ）：**
  この方法では、ローカルパッケージをリンクすることでグローバルインストールをシミュレートします。これは、本番ワークフローでローカルビルドをテストするのに役立ちます。

  ```bash
  # ローカルの cli パッケージをグローバル node_modules にリンク
  npm link packages/cli

  # これで `qwen` コマンドを使ってローカルバージョンを実行できます
  qwen
  ```

---

### 4. GitHub から最新の Qwen Code コミットを実行

GitHub リポジトリから直接、最も最近コミットされたバージョンの Qwen Code を実行できます。これは、まだ開発中の機能をテストするのに役立ちます。

```bash

# GitHubのmainブランチからCLIを直接実行する
npx https://github.com/QwenLM/qwen-code
```

## デプロイアーキテクチャ

上記で説明した実行方法は、以下のアーキテクチャコンポーネントとプロセスによって可能になっています：

**NPM パッケージ**

Qwen Code プロジェクトはモノレポであり、コアパッケージを NPM レジストリに公開します：

- `@qwen-code/qwen-code-core`: バックエンド。ロジックとツールの実行を処理します。
- `@qwen-code/qwen-code`: ユーザー向けフロントエンド。

これらのパッケージは、標準インストール時やソースから Qwen Code を実行する際に使用されます。

**ビルドおよびパッケージングプロセス**

配布チャネルに応じて、2 種類の異なるビルドプロセスが使用されます：

- **NPM 公開:** NPM レジストリへの公開では、`@qwen-code/qwen-code-core` および `@qwen-code/qwen-code` 内の TypeScript ソースコードが TypeScript コンパイラー（`tsc`）を使用して標準的な JavaScript にトランスパイルされます。生成された `dist/` ディレクトリが NPM パッケージとして公開されます。これは TypeScript ライブラリにおける一般的な手法です。

- **GitHub 経由での `npx` 実行:** GitHub から直接最新バージョンの Qwen Code を実行する場合、`package.json` の `prepare` スクリプトによって別のプロセスが起動されます。このスクリプトは `esbuild` を使用して、アプリケーション全体とその依存関係を単一の自己完結型 JavaScript ファイルにバンドルします。このバンドルファイルはユーザーのマシン上でオンザフライで作成され、リポジトリにはコミットされません。

**Docker サンドボックスイメージ**

Docker ベースの実行方法は、`qwen-code-sandbox` コンテナイメージによってサポートされています。このイメージはコンテナレジストリに公開されており、グローバルにインストールされた Qwen Code のバージョンが事前に含まれています。

## リリースプロセス

リリースプロセスは GitHub Actions を通じて自動化されています。リリースワークフローは以下のアクションを実行します：

1.  `tsc` を使用して NPM パッケージをビルドします。
2.  NPM パッケージをアーティファクトレジストリに公開します。
3.  バンドルされたアセットで GitHub リリースを作成します。