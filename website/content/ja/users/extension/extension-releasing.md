# 拡張機能のリリース

ユーザーに拡張機能をリリースする方法は主に2つあります。

- [Git リポジトリ](#git-リポジトリ経由でのリリース)
- [GitHub Releases](#github-releases経由でのリリース)

Git リポジトリによるリリースは通常、最もシンプルで柔軟なアプローチですが、GitHub Releases は単一のアーカイブとして配布されるため、初期インストール時に効率的です。個々のファイルをダウンロードするために git clone を必要としません。また、プラットフォーム固有のバイナリファイルを配布する必要がある場合、GitHub Releases にはプラットフォーム固有のアーカイブを含めることもできます。

## Git リポジトリを通じたリリース

これは最も柔軟で簡単なオプションです。必要なのは、公開アクセス可能な Git リポジトリ（例えばパブリックな GitHub リポジトリ）を作成し、ユーザーが `qwen extensions install <your-repo-uri>` コマンドを使用して拡張機能をインストールできるようにすることです。GitHub リポジトリの場合は、簡略化された形式 `qwen extensions install <org>/<repo>` を使用することもできます。また、任意で `--ref=<some-ref>` 引数を使用して特定のリファレンス（ブランチ/タグ/コミット）に依存させることも可能で、デフォルトではデフォルトブランチが使用されます。

ユーザーが依存しているリファレンスにコミットがプッシュされるたびに、拡張機能の更新が促されます。これによりロールバックも容易に行える点にも注意してください。HEAD コミットは常に最新バージョンとして扱われ、`qwen-extension.json` ファイル内の実際のバージョンとは関係ありません。

### Git リポジトリを使用したリリースチャネルの管理

ユーザーは、ブランチやタグなどの Git リポジトリ内の任意の ref に依存することができ、これにより複数のリリースチャネルを管理できます。

たとえば、`stable` ブランチを維持し、ユーザーが `qwen extensions install <your-repo-uri> --ref=stable` のようにしてインストールできるようにできます。または、デフォルトブランチを安定版リリースブランチとして扱い、別のブランチ（例えば `dev`）で開発を行うことで、これをデフォルトにすることもできます。好きなだけ多くのブランチやタグを維持でき、あなたとあなたのユーザーにとって最大限の柔軟性を提供します。

これらの `ref` 引数はタグやブランチ、あるいは特定のコミットでもよいので、ユーザーが拡張機能の特定バージョンに依存できるようになることに注意してください。タグやブランチの管理方法はあなた次第です。

### Git リポジトリを使用したリリースフローの例

Git フローを使用してリリースを管理する方法は多数ありますが、デフォルトブランチを「安定版」リリースブランチとして扱うことを推奨します。これは、`qwen extensions install <your-repo-uri>` のデフォルト動作が、安定版リリースブランチ上にあることを意味します。

ここでは、`stable`、`preview`、`dev` の 3 つの標準的なリリースチャネルを維持することを考えます。通常の開発作業はすべて `dev` ブランチで行います。プレビューリリースを行う準備ができたら、そのブランチを `preview` ブランチにマージします。プレビュー用ブランチを安定版に昇格させる準備ができたら、`preview` を安定版ブランチ（デフォルトブランチまたは別のブランチ）にマージします。

また、`git cherry-pick` を使用して、あるブランチから別のブランチへ変更点をピックアップすることもできますが、これにより各ブランチの履歴が若干分岐してしまう可能性があることに注意してください。各リリース時に履歴をクリーンな状態に戻すため、強制プッシュ（force push）を行わない限り、履歴は分岐したままになります（リポジトリの設定によっては、デフォルトブランチに対して強制プッシュができない場合があります）。チェリーピックを行う予定がある場合は、デフォルトブランチを安定版ブランチとしないようにし、デフォルトブランチへの強制プッシュを避けることを検討してください。

## GitHubリリースによる配布

Qwen Codeの拡張機能は[GitHub Releases](https://docs.github.com/en/repositories/releasing-projects-on-github/about-releases)経由で配布できます。これにより、リポジトリをクローンする必要がなくなるため、ユーザーにとって迅速かつ信頼性の高い初期インストール体験を提供します。

各リリースには少なくとも1つのアーカイブファイルが含まれており、これは関連付けられたタグ時点でのリポジトリの完全な内容を含みます。また、拡張機能にビルド手順が必要な場合やプラットフォーム固有のバイナリが添付されている場合は、[事前ビルドされたアーカイブ](#custom-pre-built-archives)も含めることができます。

更新を確認する際、qwen codeはGitHub上の最新リリース（リリース作成時にそのようにマークする必要があります）のみを検索します。ただし、ユーザーが`--ref=<some-release-tag>`を指定して特定のリリースをインストールした場合は除きます。現時点では、プレリリース版への参加選択やsemverには対応していません。

### カスタムプレビルドアーカイブ

カスタムアーカイブは、GitHubのリリースにアセットとして直接添付され、完全に自己完結している必要があります。これは、拡張機能全体を含む必要があることを意味します。[アーカイブ構造](#archive-structure)を参照してください。

もし拡張機能がプラットフォーム非依存である場合、単一の汎用アセットを提供できます。この場合、リリースには1つのみのアセットを添付する必要があります。

また、より大きなリポジトリ内で拡張機能を開発したい場合にも、カスタムアーカイブを使用できます。例えば、リポジトリ自体とは異なるレイアウトを持つアーカイブ（たとえば、拡張機能を含むサブディレクトリのみのアーカイブ）を作成することも可能です。

#### プラットフォーム固有のアーカイブ

Qwen Code が各プラットフォームに適したリリースアセットを自動的に見つけられるようにするため、以下の命名規則に従う必要があります。CLI は以下の順序でアセットを検索します。

1.  **プラットフォームとアーキテクチャ固有:** `{platform}.{arch}.{name}.{extension}`
2.  **プラットフォーム固有:** `{platform}.{name}.{extension}`
3.  **汎用:** 1つのアセットのみが提供された場合、それは汎用のフォールバックとして使用されます。

- `{name}`: 拡張機能の名前。
- `{platform}`: オペレーティングシステム。サポートされている値は以下の通りです：
  - `darwin` (macOS)
  - `linux`
  - `win32` (Windows)
- `{arch}`: アーキテクチャ。サポートされている値は以下の通りです：
  - `x64`
  - `arm64`
- `{extension}`: アーカイブのファイル拡張子 (例: `.tar.gz` または `.zip`)。

**例:**

- `darwin.arm64.my-tool.tar.gz` (Apple Silicon Mac 専用)
- `darwin.my-tool.tar.gz` (すべての Mac 用)
- `linux.x64.my-tool.tar.gz`
- `win32.my-tool.zip`

#### アーカイブ構造

アーカイブは完全に含まれた拡張機能であり、すべての標準的な要件を満たしている必要があります。具体的には、`qwen-extension.json` ファイルがアーカイブのルートに存在する必要があります。

レイアウトの残りの部分は、通常の拡張機能とまったく同じように見えるべきです。[extensions.md](extension.md) を参照してください。

#### GitHub Actions ワークフローの例

以下は、複数のプラットフォーム向けに Qwen Code 拡張機能をビルドしてリリースする GitHub Actions ワークフローの例です。

```yaml
name: Release Extension

on:
  push:
    tags:
      - 'v*'

jobs:
  release:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '20'

      - name: Install dependencies
        run: npm ci

      - name: Build extension
        run: npm run build

      - name: Create release assets
        run: |
          npm run package -- --platform=darwin --arch=arm64
          npm run package -- --platform=linux --arch=x64
          npm run package -- --platform=win32 --arch=x64

      - name: Create GitHub Release
        uses: softprops/action-gh-release@v1
        with:
          files: |
            release/darwin.arm64.my-tool.tar.gz
            release/linux.arm64.my-tool.tar.gz
            release/win32.arm64.my-tool.zip
```