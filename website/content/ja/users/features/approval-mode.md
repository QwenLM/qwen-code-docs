Qwen Code は、タスクの複雑さとリスクレベルに応じて、AI がコードやシステムとどのように相互作用するかを柔軟に制御できる 3 つの異なる権限モードを提供します。

## パーミッションモードの比較

| モード         | ファイル編集                | シェルコマンド              | 最適な用途                                                                                             | リスクレベル |
| -------------- | --------------------------- | --------------------------- | ------------------------------------------------------------------------------------------------------ | ---------- |
| **Plan**​      | ❌ 読み取り専用分析のみ      | ❌ 実行不可                 | • コード探索 <br>• 複雑な変更の計画 <br>• 安全なコードレビュー                                         | 最低       |
| **Default**​   | ✅ 手動承認が必要           | ✅ 手動承認が必要           | • 新規/見慣れないコードベース <br>• 重要なシステム <br>• チームでの共同作業 <br>• 学習および教育       | 低         |
| **Auto-Edit**​ | ✅ 自動承認                  | ❌ 手動承認が必要           | • 日常的な開発タスク <br>• リファクタリングとコード改善 <br>• 安全な自動化                            | 中         |
| **YOLO**​      | ✅ 自動承認                  | ✅ 自動承認                  | • 信頼できる個人プロジェクト <br>• 自動スクリプト/CI/CD <br>• バッチ処理タスク                         | 最高       |

### クイックリファレンスガイド

- **プランモードで開始**: 変更を行う前に理解を深めるのに最適
- **デフォルトモードで作業**: ほとんどの開発作業にバランスの取れた選択肢
- **オートエディットに切り替え**: 安全なコード変更を多数行う場合に最適
- **YOLOは控えめに使用**: 管理された環境での信頼できる自動化のみに使用

> [!tip]
>
> **Shift+Tab** を使用して、セッション中にモードを素早く切り替えることができます。ターミナルのステータスバーには現在のモードが表示されるため、Qwen Code がどのような権限を持っているか常に確認できます。

## 1. 安全なコード分析のためにプランモードを使用

プランモードでは、Qwen Code に対してコードベースを **読み取り専用** の操作で分析し、プランを作成するよう指示します。これは、コードベースの探索、複雑な変更の計画、またはコードの安全なレビューに最適です。

### プランモードを使用するタイミング

- **マルチステップ実装**: 機能が多数のファイルへの編集を必要とする場合
- **コード探索**: 何かを変更する前にコードベースを徹底的に調査したい場合
- **インタラクティブ開発**: Qwen Code で方向性を繰り返し検討したい場合

### プランモードの使い方

**セッション中にプランモードをオンにする**

セッション中に **Shift+Tab** を使用して、権限モードを切り替えることができます。

ノーマルモードの場合、**Shift+Tab** で最初に `auto-edits` モードに切り替わり、ターミナルの下部に `⏵⏵ accept edits on` と表示されます。さらに **Shift+Tab** を押すとプランモードに切り替わり、`⏸ plan mode` と表示されます。

**プランモードで新しいセッションを開始する**

プランモードで新しいセッションを開始するには、`/approval-mode` を使用し、`plan` を選択します。

```bash
/approval-mode
```

**プランモードで「ヘッドレス」クエリを実行する**

また、プランモードで直接クエリを実行することもできます。`-p` または `prompt` を使用します：

```bash
qwen --prompt "What is machine learning?"
```

### 例: 複雑なリファクタリングの計画

```bash
/approval-mode plan
```

```
認証システムをOAuth2を使用するようにリファクタリングする必要があります。詳細な移行計画を作成してください。
```

Qwen Codeは現在の実装を分析し、包括的な計画を作成します。以下のように追加の質問で計画を洗練させてください:

```
下位互換性についてはどうすればよいでしょうか？
データベースの移行はどのように処理すべきですか？
```

### プランモードをデフォルトとして設定

```json
// .qwen/settings.json
{
  "permissions": {
    "defaultMode": "plan"
  }
}
```

## 2. 制御されたインタラクションのためにデフォルトモードを使用

デフォルトモードは、Qwen Codeと連携する標準的な方法です。このモードでは、潜在的にリスクのあるすべての操作に対して完全な制御を維持できます。Qwen Codeはファイル変更やシェルコマンドの実行を行う前に、あなたの承認を求めます。

### デフォルトモードを使用するタイミング

- **コードベースに初めて触れる場合**: なじみのないプロジェクトを探索しており、特に慎重に作業したいとき
- **重要なシステム**: 本番環境のコード、インフラ、または機密データを扱っているとき
- **学習および教育**: Qwen Code が実行している各ステップを理解したいとき
- **チームでの共同作業**: 複数人が同じコードベースで作業しているとき
- **複雑な操作**: 複数のファイルや複雑なロジックを含む変更を行うとき

### デフォルトモードの使用方法

**セッション中にデフォルトモードをオンにする**

**Shift+Tab**​ を使用して、セッション中に権限モードを切り替えることができます。他のモードにいる場合でも、**Shift+Tab**​ を押すことで最終的にデフォルトモードに戻ることができます。これは、ターミナルの下部にモードインジケーターが表示されていない状態で確認できます。

**デフォルトモードで新しいセッションを開始する**

デフォルトモードは、Qwen Codeを起動した際の初期モードです。モードを変更してデフォルトモードに戻したい場合は、以下のコマンドを使用してください：

```
/approval-mode default
```

**デフォルトモードで「ヘッドレス」クエリを実行する**

ヘッドレスコマンドを実行する際、デフォルトモードがデフォルトの動作になります。明示的に指定するには以下のようにします：

```
qwen --prompt "Analyze this code for potential bugs"
```

### 例: 機能を安全に実装する

```
/approval-mode default
```

```
アプリケーションにユーザープロフィール画像を追加する必要があります。画像はS3バケットに保存し、URLはデータベースに保存します。
```

Qwen Codeはコードベースを分析し、計画を提案します。その後、以下の操作を行う前に承認を求めます：

1. 新しいファイルの作成（コントローラー、モデル、マイグレーション）
2. 既存ファイルの変更（新しいカラムの追加、APIの更新）
3. シェルコマンドの実行（データベースマイグレーション、依存関係のインストール）

各提案された変更を確認し、個別に承認または拒否できます。

### デフォルトモードをdefaultとして設定

```bash
// .qwen/settings.json
{
  "permissions": {
"defaultMode": "default"
  }
}
```

## 3. 自動編集モード

自動編集モードでは、Qwen Codeにファイル編集を自動的に承認させながら、シェルコマンドについては手動での承認を必要とするように指示します。これは、システムの安全性を維持しながら開発ワークフローを高速化するのに最適です。

### 自動承認編集モードを使用するタイミング

- **日常の開発**: ほとんどのコーディングタスクに最適
- **安全な自動化**: AIがコードを変更できるようにしつつ、危険なコマンドの誤実行を防ぐ
- **チームでの協業**: 共有プロジェクトで使用し、他人への意図しない影響を避ける

### このモードへの切り替え方法

```

# コマンドで切り替える
/approval-mode auto-edit

# またはキーボードショートカットを使用
Shift+Tab  # 他のモードから切り替える
```

### ワークフロー例

1. Qwen Codeに関数のリファクタリングを依頼する
2. AIがコードを分析し、変更提案を行う
3. **すべてのファイル変更を自動的に**​ 承認なしに適用
4. テスト実行が必要な場合、`npm test` の実行について **承認を要求**​

## 4. YOLOモード - 完全自動化

YOLOモードでは、Qwen Codeにファイル編集やシェルコマンドを含むすべてのツール呼び出しを自動承認する最高レベルの権限を与えます。

### YOLO モードを使用するタイミング

- **自動化スクリプト**: 事前定義された自動タスクの実行
- **CI/CD パイプライン**: 制御された環境での自動実行
- **個人プロジェクト**: 完全に信頼できる環境での迅速な反復
- **バッチ処理**: 複数ステップのコマンドチェーンを必要とするタスク

> [!warning]
>
> **YOLO モードは注意して使用してください**: AI はあなたの端末の権限で任意のコマンドを実行できます。以下の点を確認してください:
>
> 1. 現在のコードベースを信頼していること
> 2. AI が実行するすべてのアクションを理解していること
> 3. 重要なファイルはバックアップされている、またはバージョン管理にコミットされていること

### YOLO モードの有効化方法

```

# 一時的に有効化（現在のセッションのみ）
/approval-mode yolo

# プロジェクトのデフォルトとして設定
/approval-mode yolo --project

# ユーザーのグローバルデフォルトとして設定
/approval-mode yolo --user
```

### 設定例

```bash
// .qwen/settings.json
{
  "permissions": {
"defaultMode": "yolo",
"confirmShellCommands": false,
"confirmFileEdits": false
  }
}
```

### 自動ワークフローの例

```bash

# 完全自動化リファクタリングタスク
qwen --prompt "テストスイートを実行し、すべての失敗したテストを修正してから変更をコミットする"

# 人間の介入なしに、AIが以下を実行します：

# 1. テストコマンドを実行（自動承認）

# 2. 失敗したテストケースを修正（ファイルの自動編集）

# 3. Git コミットを実行（自動承認）
```

## モード切替と設定

### キーボードショートカットによる切替

Qwen Code セッション中は、**Shift+Tab**​ を使用して、以下の3つのモードを素早く循環的に切り替えられます：

```
デフォルトモード → 自動編集モード → YOLOモード → プランモード → デフォルトモード
```

### 永続的な設定

```
// プロジェクトレベル: ./.qwen/settings.json
// ユーザーレベル: ~/.qwen/settings.json
{
  "permissions": {
"defaultMode": "auto-edit",  // または "plan" または "yolo"
"confirmShellCommands": true,
"confirmFileEdits": true
  }
}
```

### モード使用の推奨事項

1. **コードベース初心者向け**: 安全な探索のために **プランモード** から開始
2. **日常的な開発タスク**: 効率的かつ安全な **自動承認編集モード**（デフォルトモード）を使用
3. **自動化スクリプト**: 制御された環境で完全自動化のために **YOLOモード** を使用
4. **複雑なリファクタリング**: 詳細な計画のためにまず **プランモード** を使用し、その後実行には適切なモードに切り替え