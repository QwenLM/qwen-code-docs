# Qwen Code 設定

> [!tip]
>
> **認証 / API キー:** 認証（Qwen OAuth と OpenAI 互換 API）および認証関連の環境変数（例: `OPENAI_API_KEY`）については、**[認証](../users/configuration/auth)** ページに記載されています。

> [!note]
>
> **新しい設定形式についての注意**: `settings.json` ファイルの形式が、より整理された新しい構造に更新されました。古い形式は自動的に移行されます。
> Qwen Code では、動作をカスタマイズするために、環境変数、コマンドライン引数、設定ファイルなど複数の方法を提供しています。このドキュメントでは、それぞれの設定方法と利用可能な設定項目について説明します。

## 設定レイヤー

設定は以下の優先順位に従って適用されます（数字が小さいほど低優先度で、大きいほど高優先度）:

| レベル | 設定ソース             | 説明                                                                             |
| ----- | ---------------------- | ------------------------------------------------------------------------------- |
| 1     | デフォルト値           | アプリケーション内にハードコードされたデフォルト値                               |
| 2     | システムデフォルトファイル | 他の設定ファイルによって上書き可能なシステム全体のデフォルト設定                 |
| 3     | ユーザー設定ファイル   | 現在のユーザー向けのグローバル設定                                               |
| 4     | プロジェクト設定ファイル | プロジェクト固有の設定                                                           |
| 5     | システム設定ファイル   | すべての他の設定ファイルを上書きするシステム全体の設定                           |
| 6     | 環境変数               | システム全体またはセッション固有の変数。`.env` ファイルから読み込まれる可能性あり |
| 7     | コマンドライン引数     | CLI 起動時に渡される値                                                           |

## 設定ファイル

Qwen Code は、永続的な設定のために JSON 形式の設定ファイルを使用します。これらのファイルは以下の4つの場所に配置できます。

| ファイルの種類         | 場所                                                                                                                                                                                                                                                                           | スコープ                                                                                                                                                                                                                |
| ---------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| システムデフォルトファイル | Linux: `/etc/qwen-code/system-defaults.json`<br>Windows: `C:\ProgramData\qwen-code\system-defaults.json`<br>macOS: `/Library/Application Support/QwenCode/system-defaults.json` <br>パスは環境変数 `QWEN_CODE_SYSTEM_DEFAULTS_PATH` で上書き可能です。 | システム全体のデフォルト設定のベースレイヤーを提供します。これらの設定は最も低い優先度を持ち、ユーザー、プロジェクト、またはシステムオーバーライド設定によって上書きされることを想定しています。                                      |
| ユーザー設定ファイル     | `~/.qwen/settings.json`（ここで `~` はホームディレクトリです）。                                                                                                                                                                                                              | 現在のユーザーのすべての Qwen Code セッションに適用されます。                                                                                                                                                             |
| プロジェクト設定ファイル   | プロジェクトのルートディレクトリ内の `.qwen/settings.json`。                                                                                                                                                                                                                  | 特定のプロジェクトから Qwen Code を実行している場合にのみ適用されます。プロジェクト設定はユーザー設定よりも優先されます。                                                                                                 |
| システム設定ファイル     | Linux： `/etc/qwen-code/settings.json` <br>Windows: `C:\ProgramData\qwen-code\settings.json` <br>macOS: `/Library/Application Support/QwenCode/settings.json`<br>パスは環境変数 `QWEN_CODE_SYSTEM_SETTINGS_PATH` で上書き可能です。          | システム上のすべてのユーザーに対して、すべての Qwen Code セッションに適用されます。システム設定はユーザーおよびプロジェクト設定よりも優先されます。企業でのシステム管理者がユーザーの Qwen Code のセットアップを制御するのに役立ちます。 |

> [!note]
>
> **設定における環境変数について:** `settings.json` ファイル内の文字列値では、`$VAR_NAME` または `${VAR_NAME}` 構文を使用して環境変数を参照できます。これらの変数は、設定が読み込まれる際に自動的に解決されます。例えば、環境変数 `MY_API_TOKEN` がある場合、次のように `settings.json` で使用できます：`"apiKey": "$MY_API_TOKEN"`。

### プロジェクト内の `.qwen` ディレクトリ

プロジェクト設定ファイルに加えて、プロジェクトの `.qwen` ディレクトリには、Qwen Code の操作に関連するその他のプロジェクト固有のファイルを含めることができます。例:

- [カスタムサンドボックスプロファイル](../users/features/sandbox)（例: `.qwen/sandbox-macos-custom.sb`、`.qwen/sandbox.Dockerfile`）。

### `settings.json` で利用可能な設定

設定はカテゴリ別に整理されています。すべての設定は、`settings.json` ファイル内で対応するトップレベルのカテゴリオブジェクト内に配置する必要があります。

#### 一般

| 設定                             | 型      | 説明                                      | デフォルト   |
| -------------------------------- | ------- | ----------------------------------------- | ------------ |
| `general.preferredEditor`        | string  | ファイルを開く際に優先するエディタ。      | `undefined`  |
| `general.vimMode`                | boolean | Vim キーバインドを有効にする。            | `false`      |
| `general.disableAutoUpdate`      | boolean | 自動更新を無効にする。                    | `false`      |
| `general.disableUpdateNag`       | boolean | 更新通知プロンプトを無効にする。          | `false`      |
| `general.checkpointing.enabled`  | boolean | セッションのチェックポイントによる復旧を有効にする。 | `false`      |

#### output

| 設定            | 型     | 説明                          | デフォルト | 可能な値           |
| --------------- | ------ | ----------------------------- | -------- | ------------------ |
| `output.format` | string | CLI 出力の形式。              | `"text"` | `"text"`, `"json"` |

#### ui

| 設定                                     | 型               | 説明                                                                                                                                                                                                                                                                                                                                                                                                                | デフォルト  |
| ---------------------------------------- | ---------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------- |
| `ui.theme`                               | string           | UI のカラーテーマ。利用可能なオプションについては、[テーマ](../users/configuration/themes) を参照してください。                                                                                                                                                                                                                                                                                                         | `undefined` |
| `ui.customThemes`                        | object           | カスタムテーマの定義。                                                                                                                                                                                                                                                                                                                                                                                              | `{}`        |
| `ui.hideWindowTitle`                     | boolean          | ウィンドウのタイトルバーを非表示にします。                                                                                                                                                                                                                                                                                                                                                                           | `false`     |
| `ui.hideTips`                            | boolean          | UI 内の役立つヒントを非表示にします。                                                                                                                                                                                                                                                                                                                                                                                | `false`     |
| `ui.hideBanner`                          | boolean          | アプリケーションバナーを非表示にします。                                                                                                                                                                                                                                                                                                                                                                             | `false`     |
| `ui.hideFooter`                          | boolean          | UI からフッターを非表示にします。                                                                                                                                                                                                                                                                                                                                                                                   | `false`     |
| `ui.showMemoryUsage`                     | boolean          | UI にメモリ使用量情報を表示します。                                                                                                                                                                                                                                                                                                                                                                                  | `false`     |
| `ui.showLineNumbers`                     | boolean          | CLI 出力のコードブロックに行番号を表示します。                                                                                                                                                                                                                                                                                                                                                                       | `true`      |
| `ui.showCitations`                       | boolean          | チャットで生成されたテキストの引用を表示します。                                                                                                                                                                                                                                                                                                                                                                     | `true`      |
| `enableWelcomeBack`                      | boolean          | 会話履歴のあるプロジェクトに戻ってきたときに「おかえり」ダイアログを表示します。有効にすると、Qwen Code は以前に生成されたプロジェクトサマリー（`.qwen/PROJECT_SUMMARY.md`）があるプロジェクトに戻ってきたことを自動的に検出し、以前の会話を続けるか新しく始めるかを選択できるダイアログを表示します。この機能は `/summary` コマンドおよび終了確認ダイアログと統合されています。 | `true`      |
| `ui.accessibility.disableLoadingPhrases` | boolean          | アクセシビリティのためにロード中のフレーズを無効にします。                                                                                                                                                                                                                                                                                                                                                            | `false`     |
| `ui.accessibility.screenReader`          | boolean          | スクリーンリーダーモードを有効にし、TUI をスクリーンリーダーとの互換性が向上するように調整します。                                                                                                                                                                                                                                                                                                                      | `false`     |
| `ui.customWittyPhrases`                  | array of strings | ロード中に表示するカスタムフレーズのリスト。指定された場合、CLI はデフォルトのフレーズの代わりにこれらのフレーズを順番に表示します。                                                                                                                                                                                                                                                                                    | `[]`        |

#### ide

| 設定            | 型      | 説明                                          | デフォルト |
| ------------------ | ------- | ---------------------------------------------------- | ------- |
| `ide.enabled`      | boolean | IDE連携モードを有効にする。                         | `false` |
| `ide.hasSeenNudge` | boolean | ユーザーがIDE連携の案内を見たことがあるかどうか。 | `false` |

#### privacy

| 設定                          | 型      | 説明                            | デフォルト |
| -------------------------------- | ------- | -------------------------------------- | ------- |
| `privacy.usageStatisticsEnabled` | boolean | 使用統計情報の収集を有効にする。 | `true`  |

#### model

| 設定項目                                            | 型      | 説明                                                                                                                                                                                                                                                                                                                                                             | デフォルト   |
| -------------------------------------------------- | ------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------- |
| `model.name`                                       | string  | 会話で使用する Qwen モデルを指定します。                                                                                                                                                                                                                                                                                                                           | `undefined` |
| `model.maxSessionTurns`                            | number  | セッション内で保持するユーザー／モデル／ツールの最大ターン数を設定します。-1 は無制限を意味します。                                                                                                                                                                                                                                                                                  | `-1`        |
| `model.summarizeToolOutput`                        | object  | ツール出力の要約機能を有効または無効にします。`tokenBudget` 設定を使用して、要約に使用するトークン予算を指定できます。注：現在は `run_shell_command` ツールのみがサポートされています。例：`{"run_shell_command": {"tokenBudget": 2000}}`                                                                                                                              | `undefined` |
| `model.generationConfig`                           | object  | 下層のコンテンツジェネレーターに渡される高度なオーバーライド設定です。`timeout`、`maxRetries`、`disableCacheControl` などのリクエスト制御と、`samplingParams` 配下の詳細調整用パラメータ（例：`temperature`、`top_p`、`max_tokens`）をサポートします。プロバイダーのデフォルト値を使用する場合は未設定のままにしてください。                                                       | `undefined` |
| `model.chatCompression.contextPercentageThreshold` | number  | チャット履歴圧縮のしきい値をモデルの総トークン上限に対する割合として設定します。これは 0 から 1 の間の値であり、自動圧縮および手動 `/compress` コマンドの両方に適用されます。例えば `0.6` を設定すると、チャット履歴がトークン上限の 60% を超えた時点で圧縮が開始されます。`0` を設定すると圧縮を完全に無効化します。                                                             | `0.7`       |
| `model.skipNextSpeakerCheck`                       | boolean | 次の発言者のチェックをスキップします。                                                                                                                                                                                                                                                                                                                            | `false`     |
| `model.skipLoopDetection`                          | boolean | ループ検出チェックを無効にします。ループ検出は AI 応答における無限ループを防ぐための機能ですが、誤検出により正当なワークフローが中断されることがあります。頻繁に誤検出による中断が発生する場合はこのオプションを有効にしてください。                                                                                                                                                              | `false`     |
| `model.skipStartupContext`                         | boolean | 各セッション開始時に起動時のワークスペースコンテキスト（環境概要と確認メッセージ）の送信をスキップします。コンテキストを手動で提供したい場合や、起動時のトークン消費を節約したい場合に有効にしてください。                                                                                                                                                                                      | `false`     |
| `model.enableOpenAILogging`                        | boolean | OpenAI API 呼び出しのログ記録を有効にして、デバッグおよび分析を行えるようにします。有効にすると、API のリクエストおよびレスポンスが JSON ファイルに記録されます。                                                                                                                                                                                                      | `false`     |
| `model.openAILoggingDir`                           | string  | OpenAI API ログのカスタムディレクトリパスを指定します。未指定の場合、デフォルトではカレントディレクトリ内の `logs/openai` になります。絶対パス、相対パス（カレントディレクトリからの相対）、および `~` 展開（ホームディレクトリ）に対応しています。                                                                                                                                   | `undefined` |

**model.generationConfig の例:**

```
{
  "model": {
    "generationConfig": {
      "timeout": 60000,
      "disableCacheControl": false,
      "samplingParams": {
        "temperature": 0.2,
        "top_p": 0.8,
        "max_tokens": 1024
      }
    }
  }
}
```

**model.openAILoggingDir の例:**

- `"~/qwen-logs"` - `~/qwen-logs` ディレクトリにログを出力
- `"./custom-logs"` - カレントディレクトリからの相対パス `./custom-logs` にログを出力
- `"/tmp/openai-logs"` - 絶対パス `/tmp/openai-logs` にログを出力

#### context

| 設定項目                                              | 型                         | 説明                                                                                                                                                                                                                                                                                                                                                                | デフォルト値    |
| --------------------------------------------------- | -------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------- |
| `context.fileName`                                  | 文字列または文字列の配列   | コンテキストファイルの名前。                                                                                                                                                                                                                                                                                                                                        | `undefined`     |
| `context.importFormat`                              | 文字列                     | メモリをインポートする際に使用する形式。                                                                                                                                                                                                                                                                                                                            | `undefined`     |
| `context.discoveryMaxDirs`                          | 数値                       | メモリを検索するディレクトリの最大数。                                                                                                                                                                                                                                                                                                                              | `200`           |
| `context.includeDirectories`                        | 配列                       | ワークスペースのコンテキストに含める追加ディレクトリ。ワークスペースのコンテキストに含める追加の絶対パスまたは相対パスの配列を指定します。存在しないディレクトリは、デフォルトでは警告を表示してスキップされます。パスには `~` を使用してユーザーのホームディレクトリを参照できます。この設定は `--include-directories` コマンドラインフラグと組み合わせて使用できます。 | `[]`            |
| `context.loadFromIncludeDirectories`                | 真偽値                     | `/memory refresh` コマンドの動作を制御します。`true` に設定すると、追加されたすべてのディレクトリから `QWEN.md` ファイルを読み込む必要があります。`false` に設定すると、現在のディレクトリからのみ `QWEN.md` を読み込みます。                                                                                                                                    | `false`         |
| `context.fileFiltering.respectGitIgnore`            | 真偽値                     | 検索時に .gitignore ファイルを尊重するかどうか。                                                                                                                                                                                                                                                                                                                    | `true`          |
| `context.fileFiltering.respectQwenIgnore`           | 真偽値                     | 検索時に .qwenignore ファイルを尊重するかどうか。                                                                                                                                                                                                                                                                                                                   | `true`          |
| `context.fileFiltering.enableRecursiveFileSearch`   | 真偽値                     | プロンプトで `@` 接頭辞を補完する際に、現在のツリー以下のファイル名を再帰的に検索するかどうか。                                                                                                                                                                                                                                                                      | `true`          |
| `context.fileFiltering.disableFuzzySearch`          | 真偽値                     | `true` の場合、ファイル検索時のあいまい検索機能を無効にし、大量のファイルを持つプロジェクトでのパフォーマンスを向上させることができます。                                                                                                                                                                                                                            | `false`         |

#### ファイル検索パフォーマンスのトラブルシューティング

ファイル検索（例：`@` 補完）でパフォーマンスの問題が発生している場合、特に非常に多くのファイルを含むプロジェクトでは、以下に示すいくつかの対処法を推奨順に試してみてください：

1. **`.qwenignore` を使用する：** プロジェクトのルートディレクトリに `.qwenignore` ファイルを作成し、参照する必要がない大量のファイルを含むディレクトリ（例：ビルド成果物、ログ、`node_modules`）を除外します。クロールされるファイルの総数を減らすことが、パフォーマンスを向上させる最も効果的な方法です。
2. **ファジー検索を無効にする：** ファイルを無視するだけでは不十分な場合、`settings.json` ファイルで `disableFuzzySearch` を `true` に設定することで、ファジー検索を無効にできます。これにより、よりシンプルで非ファジーのマッチングアルゴリズムが使用され、高速化が期待できます。
3. **再帰的ファイル検索を無効にする：** 最後の手段として、`enableRecursiveFileSearch` を `false` に設定することで、再帰的なファイル検索を完全に無効にできます。これによりプロジェクト全体の再帰的なクロールを回避できるため、最も高速なオプションとなります。ただし、`@` 補完を使用する際にはファイルへのフルパスを入力する必要があります。

#### ツール

| 設定                                 | 型                | 説明                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | デフォルト  | 注記                                                                                                                                                                                                                                                 |
| ------------------------------------ | ----------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `tools.sandbox`                      | boolean または string | サンドボックス実行環境（boolean またはパス文字列を指定可能）。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | `undefined` |                                                                                                                                                                                                                                                      |
| `tools.shell.enableInteractiveShell` | boolean           | 対話型シェル体験のために `node-pty` を使用します。`child_process` へのフォールバックは引き続き有効です。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | `false`     |                                                                                                                                                                                                                                                      |
| `tools.core`                         | 文字列の配列       | 組み込みツールのセットを許可リストで制限するために使用できます。また、`run_shell_command` ツールのように対応するツールに対してコマンド固有の制限を指定することも可能です。例えば、`"tools.core": ["run_shell_command(ls -l)"]` とすると、`ls -l` コマンドのみが実行できるようになります。                                                                                                                                                                                                                                                                                                                                                                                                                                                           | `undefined` |                                                                                                                                                                                                                                                      |
| `tools.exclude`                      | 文字列の配列       | 検出から除外するツール名を指定します。また、`run_shell_command` ツールのように対応するツールに対してコマンド固有の制限を指定することも可能です。例えば、`"tools.exclude": ["run_shell_command(rm -rf)"]` とすると、`rm -rf` コマンドがブロックされます。**セキュリティ上の注意：** `tools.exclude` での `run_shell_command` のコマンド固有の制限は単純な文字列一致に基づいており、簡単に回避可能です。この機能は**セキュリティメカニズムではない**ため、信頼できないコードを安全に実行するために依存すべきではありません。実行可能なコマンドを明示的に選択するには `tools.core` の使用を推奨します。                                                                                                                             | `undefined` |                                                                                                                                                                                                                                                      |
| `tools.allowed`                      | 文字列の配列       | 確認ダイアログをバイパスするツール名のリストです。頻繁に使用し信頼できるツールに便利です。例えば、`["run_shell_command(git)", "run_shell_command(npm test)"]` とすると、任意の `git` および `npm test` コマンドの確認ダイアログをスキップします。                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | `undefined` |                                                                                                                                                                                                                                                      |
| `tools.approvalMode`                 | string            | ツール使用時のデフォルト承認モードを設定します。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | `default`   | 可能な値：`plan`（分析のみ、ファイル変更やコマンド実行はしない）、`default`（ファイル編集やシェルコマンド実行前に承認が必要）、`auto-edit`（ファイル編集を自動承認）、`yolo`（すべてのツール呼び出しを自動承認） |
| `tools.discoveryCommand`             | string            | ツール検出のために実行するコマンド。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | `undefined` |                                                                                                                                                                                                                                                      |
| `tools.callCommand`                  | string            | `tools.discoveryCommand` を使用して検出した特定のツールを呼び出すためのカスタムシェルコマンドを定義します。シェルコマンドは以下の条件を満たす必要があります：最初のコマンドライン引数として関数の `name`（[関数宣言](https://ai.google.dev/gemini-api/docs/function-calling#function-declarations) におけるものと正確に一致）を受け取ること。関数引数を `stdin` から JSON 形式で読み取ること（[`functionCall.args`](https://cloud.google.com/vertex-ai/generative-ai/docs/model-reference/inference#functioncall) に類似）。関数出力を `stdout` に JSON 形式で返すこと（[`functionResponse.response.content`](https://cloud.google.com/vertex-ai/generative-ai/docs/model-reference/inference#functionresponse) に類似）。 | `undefined` |                                                                                                                                                                                                                                                      |
| `tools.useRipgrep`                   | boolean           | フォールバック実装の代わりに ripgrep を使用してファイル内容を検索します。より高速な検索パフォーマンスを提供します。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | `true`      |                                                                                                                                                                                                                                                      |
| `tools.useBuiltinRipgrep`            | boolean           | バンドルされた ripgrep バイナリを使用します。`false` に設定すると、システムレベルの `rg` コマンドが代わりに使用されます。この設定は `tools.useRipgrep` が `true` の場合にのみ有効です。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | `true`      |                                                                                                                                                                                                                                                      |
| `tools.enableToolOutputTruncation`   | boolean           | 大きなツール出力の切り捨てを有効にします。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | `true`      | 再起動が必要：はい                                                                                                                                                                                                                                   |
| `tools.truncateToolOutputThreshold`  | number            | この文字数を超えるツール出力を切り捨てます。Shell、Grep、Glob、ReadFile、ReadManyFiles ツールに適用されます。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | `25000`     | 再起動が必要：はい                                                                                                                                                                                                                                   |
| `tools.truncateToolOutputLines`      | number            | ツール出力の切り捨て時に保持される最大行数またはエントリ数。Shell、Grep、Glob、ReadFile、ReadManyFiles ツールに適用されます。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        | `1000`      | 再起動が必要：はい                                                                                                                                                                                                                                   |
| `tools.autoAccept`                   | boolean           | 安全と見なされるツール呼び出し（例：読み取り専用操作）について、明示的なユーザー確認なしに CLI が自動的に受け入れて実行するかどうかを制御します。`true` に設定すると、安全と判断されたツールの確認プロンプトを CLI がバイパスします。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | `false`     |                                                                                                                                                                                                                                                      |

#### mcp

| 設定                | 型               | 説明                                                                                                                                                                                                                                                                           | デフォルト  |
| ------------------- | ---------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | ----------- |
| `mcp.serverCommand` | 文字列           | MCP サーバーを起動するコマンド。                                                                                                                                                                                                                                               | `undefined` |
| `mcp.allowed`       | 文字列の配列     | 使用を許可する MCP サーバーの許可リスト。モデルで利用可能にする MCP サーバー名のリストを指定できます。これにより、接続する MCP サーバーのセットを制限できます。`--allowed-mcp-server-names` が設定されている場合、この設定は無視されることに注意してください。                      | `undefined` |
| `mcp.excluded`      | 文字列の配列     | 使用を除外する MCP サーバーの拒否リスト。`mcp.excluded` と `mcp.allowed` の両方に記載されたサーバーは除外されます。`--allowed-mcp-server-names` が設定されている場合、この設定は無視されることに注意してください。                                                               | `undefined` |

> [!note]
>
> **MCP サーバーに関するセキュリティ上の注意:** これらの設定では、MCP サーバー名に対して単純な文字列一致を使用しており、その名前は変更可能です。システム管理者として、ユーザーがこれをバイパスできないようにするには、システム設定レベルで `mcpServers` を構成し、ユーザーが独自の MCP サーバーを設定できないようにすることを検討してください。これは絶対的なセキュリティメカニズムとしては使用しないでください。

#### セキュリティ

| 設定項目                         | 型      | 説明                                             | デフォルト値  |
| ------------------------------ | ------- | ----------------------------------------------- | ----------- |
| `security.folderTrust.enabled` | boolean | フォルダ信頼が有効かどうかを追跡する設定。           | `false`     |
| `security.auth.selectedType`   | string  | 現在選択されている認証タイプ。                     | `undefined` |
| `security.auth.enforcedType`   | string  | 必須の認証タイプ（企業向けに有用）。                | `undefined` |
| `security.auth.useExternal`    | boolean | 外部認証フローを使用するかどうか。                  | `undefined` |

#### advanced

| 設定                           | 型               | 説明                                                                                                                                                                                                                                                                                                                              | デフォルト値             |
| ------------------------------ | ---------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------ |
| `advanced.autoConfigureMemory` | boolean          | Node.js のメモリ制限を自動的に設定します。                                                                                                                                                                                                                                                                                         | `false`                  |
| `advanced.dnsResolutionOrder`  | string           | DNS 解決の順序を指定します。                                                                                                                                                                                                                                                                                                      | `undefined`              |
| `advanced.excludedEnvVars`     | string の配列     | プロジェクトコンテキストから除外する環境変数を指定します。プロジェクトの `.env` ファイルから読み込まれるべきではない環境変数を指定します。これにより、プロジェクト固有の環境変数（例：`DEBUG=true`）が CLI の動作に干渉することを防ぎます。`.qwen/.env` ファイルからの変数は常に除外されません。 | `["DEBUG","DEBUG_MODE"]` |
| `advanced.bugCommand`          | object           | バグ報告コマンドの設定です。`/bug` コマンドのデフォルト URL を上書きします。プロパティ：`urlTemplate`（文字列）— `{title}` および `{info}` プレースホルダーを含むことができる URL。例：`"bugCommand": { "urlTemplate": "https://bug.example.com/new?title={title}&info={info}" }`                                               | `undefined`              |
| `advanced.tavilyApiKey`        | string           | Tavily ウェブ検索サービスの API キーです。`web_search` ツール機能を有効にするために使用されます。                                                                                                                                                                                                                                   | `undefined`              |

> [!note]
>
> **advanced.tavilyApiKey についての注意：** これはレガシーな設定形式です。Qwen OAuth ユーザーの場合、DashScope プロバイダーは設定なしで自動的に利用可能です。他の認証タイプの場合は、新しい `webSearch` 設定形式を使用して Tavily または Google プロバイダーを設定してください。

#### mcpServers

カスタムツールを検出および使用するための1つ以上のModel-Context Protocol（MCP）サーバーへの接続を設定します。Qwen Codeは、設定された各MCPサーバーに接続を試み、利用可能なツールを検出します。複数のMCPサーバーが同じ名前のツールを公開している場合、競合を避けるために、設定で定義したサーバーエイリアスがツール名の前に付加されます（例：`serverAlias__actualToolName`）。システムは互換性のためにMCPツール定義から特定のスキーマプロパティを削除することがあります。少なくとも`command`、`url`、または`httpUrl`のいずれか1つを指定する必要があります。複数が指定された場合、優先順位は`httpUrl`、次に`url`、最後に`command`です。

| プロパティ                                | 型               | 説明                                                                                                                                                                                                                                                               | 省略可   |
| ---------------------------------------- | ---------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | -------- |
| `mcpServers.<SERVER_NAME>.command`       | string           | 標準I/O経由でMCPサーバーを起動するために実行するコマンド。                                                                                                                                                                                                         | はい     |
| `mcpServers.<SERVER_NAME>.args`          | array of strings | コマンドに渡す引数。                                                                                                                                                                                                                                               | はい     |
| `mcpServers.<SERVER_NAME>.env`           | object           | サーバープロセスに設定する環境変数。                                                                                                                                                                                                                               | はい     |
| `mcpServers.<SERVER_NAME>.cwd`           | string           | サーバーを起動する作業ディレクトリ。                                                                                                                                                                                                                               | はい     |
| `mcpServers.<SERVER_NAME>.url`           | string           | Server-Sent Events（SSE）を使用して通信するMCPサーバーのURL。                                                                                                                                                                                                      | はい     |
| `mcpServers.<SERVER_NAME>.httpUrl`       | string           | ストリーム可能なHTTPを使用して通信するMCPサーバーのURL。                                                                                                                                                                                                           | はい     |
| `mcpServers.<SERVER_NAME>.headers`       | object           | `url`または`httpUrl`へのリクエストと一緒に送信するHTTPヘッダーのマップ。                                                                                                                                                                                          | はい     |
| `mcpServers.<SERVER_NAME>.timeout`       | number           | このMCPサーバーへのリクエストのタイムアウト（ミリ秒）。                                                                                                                                                                                                            | はい     |
| `mcpServers.<SERVER_NAME>.trust`         | boolean          | このサーバーを信頼し、すべてのツール呼び出し確認をバイパスする。                                                                                                                                                                                                   | はい     |
| `mcpServers.<SERVER_NAME>.description`   | string           | 表示目的で使用されるサーバーの簡単な説明。                                                                                                                                                                                                                         | はい     |
| `mcpServers.<SERVER_NAME>.includeTools`  | array of strings | このMCPサーバーから含めるツール名のリスト。指定された場合、ここにリストされたツールのみがこのサーバーから利用可能になります（許可リストの動作）。指定されていない場合、デフォルトですべてのサーバーツールが有効になります。                                           | はい     |
| `mcpServers.<SERVER_NAME>.excludeTools`  | array of strings | このMCPサーバーから除外するツール名のリスト。ここにリストされたツールは、サーバーによって公開されていてもモデルでは利用できません。**注：** `excludeTools`は`includeTools`より優先されます。両方のリストにツールがある場合、それは除外されます。                      | はい     |

#### テレメトリ

Qwen Code のロギングとメトリクス収集を設定します。詳細については、[テレメトリ](/developers/development/telemetry) を参照してください。

| 設定項目                 | 型      | 説明                                                                           | デフォルト |
| ------------------------ | ------- | ------------------------------------------------------------------------------ | ---------- |
| `telemetry.enabled`      | boolean | テレメトリが有効かどうか。                                                     |            |
| `telemetry.target`       | string  | 収集されたテレメトリの送信先。サポートされる値は `local` および `gcp`。        |            |
| `telemetry.otlpEndpoint` | string  | OTLP エクスポーターのエンドポイント。                                          |            |
| `telemetry.otlpProtocol` | string  | OTLP エクスポーターのプロトコル（`grpc` または `http`）。                      |            |
| `telemetry.logPrompts`   | boolean | ユーザーのプロンプト内容をログに含めるかどうか。                               |            |
| `telemetry.outfile`      | string  | `target` が `local` の場合にテレメトリを書き込むファイル。                     |            |
| `telemetry.useCollector` | boolean | 外部の OTLP コレクターを使用するかどうか。                                     |            |

### 例 `settings.json`

以下は、v0.3.0から新たに追加されたネスト構造を持つ `settings.json` ファイルの例です。

```
{
  "general": {
    "vimMode": true,
    "preferredEditor": "code"
  },
  "ui": {
    "theme": "GitHub",
    "hideBanner": true,
    "hideTips": false,
    "customWittyPhrases": [
      "You forget a thousand things every day. Make sure this is one of 'em",
      "Connecting to AGI"
    ]
  },
  "tools": {
    "approvalMode": "yolo",
    "sandbox": "docker",
    "discoveryCommand": "bin/get_tools",
    "callCommand": "bin/call_tool",
    "exclude": ["write_file"]
  },
  "mcpServers": {
    "mainServer": {
      "command": "bin/mcp_server.py"
    },
    "anotherServer": {
      "command": "node",
      "args": ["mcp_server.js", "--verbose"]
    }
  },
  "telemetry": {
    "enabled": true,
    "target": "local",
    "otlpEndpoint": "http://localhost:4317",
    "logPrompts": true
  },
  "privacy": {
    "usageStatisticsEnabled": true
  },
  "model": {
    "name": "qwen3-coder-plus",
    "maxSessionTurns": 10,
    "enableOpenAILogging": false,
    "openAILoggingDir": "~/qwen-logs",
    "summarizeToolOutput": {
      "run_shell_command": {
        "tokenBudget": 100
      }
    }
  },
  "context": {
    "fileName": ["CONTEXT.md", "QWEN.md"],
    "includeDirectories": ["path/to/dir1", "~/path/to/dir2", "../path/to/dir3"],
    "loadFromIncludeDirectories": true,
    "fileFiltering": {
      "respectGitIgnore": false
    }
  },
  "advanced": {
    "excludedEnvVars": ["DEBUG", "DEBUG_MODE", "NODE_ENV"]
  }
}
```

## Shell 履歴

CLI は実行したシェルコマンドの履歴を保持します。異なるプロジェクト間での競合を避けるため、この履歴はユーザーのホームフォルダ内のプロジェクト固有のディレクトリに保存されます。

- **場所:** `~/.qwen/tmp/<project_hash>/shell_history`
  - `<project_hash>` はプロジェクトのルートパスから生成された一意の識別子です。
  - 履歴は `shell_history` という名前のファイルに保存されます。

## 環境変数と `.env` ファイル

環境変数は、アプリケーションを設定する一般的な方法であり、特に機密情報（トークンなど）や環境によって変わる設定に適しています。

Qwen Code は `.env` ファイルから環境変数を自動的に読み込むことができます。  
認証関連の変数（`OPENAI_*` など）や推奨される `.qwen/.env` の使い方については、**[認証](../users/configuration/auth)** を参照してください。

> [!tip]
>
> **環境変数の除外:** 一部の環境変数（例：`DEBUG` や `DEBUG_MODE`）は、CLI の動作への干渉を防ぐため、プロジェクトの `.env` ファイルからデフォルトで自動的に除外されます。`.qwen/.env` ファイルの変数は除外されません。この動作は、`settings.json` ファイルの `advanced.excludedEnvVars` 設定でカスタマイズできます。

### 環境変数テーブル

| 変数名                           | 説明                                                                                                                                                   | 備考                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| ------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `GEMINI_TELEMETRY_ENABLED`     | テレメトリを有効にするには `true` または `1` を設定します。他の値は無効として扱われます。                                                              | `telemetry.enabled` 設定を上書きします。                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| `GEMINI_TELEMETRY_TARGET`      | テレメトリのターゲットを設定します（`local` または `gcp`）。                                                                                            | `telemetry.target` 設定を上書きします。                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| `GEMINI_TELEMETRY_OTLP_ENDPOINT` | テレメトリ用の OTLP エンドポイントを設定します。                                                                                                         | `telemetry.otlpEndpoint` 設定を上書きします。                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| `GEMINI_TELEMETRY_OTLP_PROTOCOL` | OTLP プロトコルを設定します（`grpc` または `http`）。                                                                                                   | `telemetry.otlpProtocol` 設定を上書きします。                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| `GEMINI_TELEMETRY_LOG_PROMPTS` | ユーザープロンプトのログ記録を有効にするには `true` または `1` を設定します。他の値は無効として扱われます。                                               | `telemetry.logPrompts` 設定を上書きします。                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| `GEMINI_TELEMETRY_OUTFILE`     | ターゲットが `local` の場合にテレメトリを書き込むファイルパスを設定します。                                                                             | `telemetry.outfile` 設定を上書きします。                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| `GEMINI_TELEMETRY_USE_COLLECTOR` | 外部 OTLP コレクターの使用を有効にするには `true` または `1` を設定します。他の値は無効として扱われます。                                                | `telemetry.useCollector` 設定を上書きします。                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| `GEMINI_SANDBOX`               | `settings.json` 内の `sandbox` 設定の代替です。                                                                                                        | `true`、`false`、`docker`、`podman`、またはカスタムコマンド文字列を受け入れます。                                                                                                                                                                                                                                                                                                                                                                                                |
| `SEATBELT_PROFILE`             | （macOS 固有）macOS 上で Seatbelt（`sandbox-exec`）プロファイルを切り替えます。                                                                          | `permissive-open`: （デフォルト）プロジェクトフォルダ（およびその他の一部のフォルダ、詳細は `packages/cli/src/utils/sandbox-macos-permissive-open.sb` 参照）への書き込みを制限しますが、他の操作は許可されます。`strict`: デフォルトで操作を拒否する厳格なプロファイルを使用します。`<profile_name>`: カスタムプロファイルを使用します。カスタムプロファイルを定義するには、プロジェクトの `.qwen/` ディレクトリ内に `sandbox-macos-<profile_name>.sb` という名前のファイルを作成してください（例：`my-project/.qwen/sandbox-macos-custom.sb`）。 |
| `DEBUG` または `DEBUG_MODE`    | （多くの場合、下位ライブラリや CLI 自体によって使用される）詳細なデバッグログを有効にするには `true` または `1` を設定します。トラブルシューティングに役立ちます。 | **注意:** これらの変数は、CLI の動作への干渉を防ぐため、プロジェクトの `.env` ファイルからデフォルトで自動的に除外されます。Qwen Code 専用にこれらを設定する必要がある場合は、`.qwen/.env` ファイルを使用してください。                                                                                                                                                                                                                                                      |
| `NO_COLOR`                     | 任意の値を設定すると、CLI でのすべてのカラー出力を無効にします。                                                                                        |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| `CLI_TITLE`                    | 文字列を設定して、CLI のタイトルをカスタマイズします。                                                                                                  |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| `CODE_ASSIST_ENDPOINT`         | コードアシストサーバーのエンドポイントを指定します。                                                                                                    | 開発およびテストに役立ちます。                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| `TAVILY_API_KEY`               | Tavily ウェブ検索サービスの API キー。                                                                                                                 | `web_search` ツール機能を有効にするために使用されます。例: `export TAVILY_API_KEY="tvly-your-api-key-here"`                                                                                                                                                                                                                                                                                                                                                                       |

## コマンドライン引数

CLI実行時に直接渡される引数は、その特定のセッションにおいて他の設定を上書きできます。

### コマンドライン引数テーブル

| 引数                         | エイリアス | 説明                                                                                                                                                                             | 可能な値                            | 備考                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| ---------------------------- | ---------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| `--model`                    | `-m`       | このセッションで使用する Qwen モデルを指定します。                                                                                                                               | モデル名                            | 例: `npm start -- --model qwen3-coder-plus`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| `--prompt`                   | `-p`       | プロンプトを直接コマンドに渡すために使用されます。これにより、Qwen Code は非対話モードで起動されます。                                                                              | プロンプトテキスト                 | スクリプトの例については、構造化された出力を得るために `--output-format json` フラグを使用してください。                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| `--prompt-interactive`       | `-i`       | 指定されたプロンプトを初期入力として対話セッションを開始します。                                                                                                                   | プロンプトテキスト                 | プロンプトは対話セッション内で処理され、セッション開始前には処理されません。stdin からのパイプ入力時には使用できません。例: `qwen -i "explain this code"`                                                                                                                                                                                                                                                                                                                                                                                                     |
| `--output-format`            | `-o`       | 非対話モードでの CLI 出力形式を指定します。                                                                                                                                       | `text`, `json`, `stream-json`       | `text`: （デフォルト）標準的な人間が読める出力です。`json`: 実行終了時にマシンが読み取れる JSON 形式で出力されます。`stream-json`: 実行中に発生したストリーミング JSON メッセージを逐次出力します。構造化された出力やスクリプト用途では、`--output-format json` または `--output-format stream-json` フラグを使用してください。詳細は [Headless Mode](../users/features/headless) を参照してください。                                                                                                               |
| `--input-format`             |            | 標準入力から受け取る形式を指定します。                                                                                                                                           | `text`, `stream-json`               | `text`: （デフォルト）stdin またはコマンドライン引数からの標準テキスト入力です。`stream-json`: 双方向通信のために stdin 経由で JSON メッセージプロトコルを使用します。要件：`--input-format stream-json` を使用するには `--output-format stream-json` の設定が必要です。`stream-json` 使用時は stdin がプロトコルメッセージ専用になります。詳細は [Headless Mode](../users/features/headless) を参照してください。                                                                                                   |
| `--include-partial-messages` |            | `stream-json` 出力形式使用時にアシスタントの部分的なメッセージを含めます。有効にすると、ストリーミング中に発生する（message_start、content_block_delta などの）ストリームイベントを逐次出力します。 |                                 | デフォルト: `false`。要件: `--output-format stream-json` の設定が必要です。ストリームイベントの詳細については [Headless Mode](../users/features/headless) を参照してください。                                                                                                                                                                                                                                                                                                                                                                                      |
| `--sandbox`                  | `-s`       | このセッションでサンドボックスモードを有効にします。                                                                                                                              |                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| `--sandbox-image`            |            | サンドボックスイメージの URI を設定します。                                                                                                                                      |                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| `--debug`                    | `-d`       | このセッションでデバッグモードを有効にし、より詳細な出力を提供します。                                                                                                            |                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| `--all-files`                | `-a`       | 設定すると、現在のディレクトリ内のすべてのファイルを再帰的にプロンプトのコンテキストに含めます。                                                                                  |                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| `--help`                     | `-h`       | コマンドライン引数に関するヘルプ情報を表示します。                                                                                                                               |                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| `--show-memory-usage`        |            | 現在のメモリ使用量を表示します。                                                                                                                                                 |                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| `--yolo`                     |            | YOLO モードを有効にし、すべてのツール呼び出しを自動承認します。                                                                                                                  |                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| `--approval-mode`            |            | ツール呼び出しの承認モードを設定します。                                                                                                                                         | `plan`, `default`, `auto-edit`, `yolo` | サポートされるモード: `plan`: 分析のみ—ファイル変更やコマンド実行は行いません。`default`: ファイル編集やシェルコマンド実行には承認が必要（デフォルト動作）。`auto-edit`: 編集ツール（edit、write_file）は自動承認し、それ以外は確認を求めます。`yolo`: すべてのツール呼び出しを自動承認します（`--yolo` と同等）。`--yolo` とは同時に使用できません。新しい統一アプローチでは `--yolo` の代わりに `--approval-mode=yolo` を使用してください。例: `qwen --approval-mode auto-edit`<br>[Approval Mode](../users/features/approval-mode) の詳細をご覧ください。 |
| `--allowed-tools`            |            | 確認ダイアログをバイパスするツール名のカンマ区切りリストです。                                                                                                                   | ツール名                            | 例: `qwen --allowed-tools "Shell(git status)"`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| `--telemetry`                |            | [テレメトリ](/developers/development/telemetry) を有効にします。                                                                                                                |                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| `--telemetry-target`         |            | テレメトリのターゲットを設定します。                                                                                                                                             |                                 | 詳細は [テレメトリ](/developers/development/telemetry) を参照してください。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| `--telemetry-otlp-endpoint`  |            | テレメトリ用の OTLP エンドポイントを設定します。                                                                                                                                 |                                 | 詳細は [テレメトリ](/developers/development/telemetry) を参照してください。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| `--telemetry-otlp-protocol`  |            | テレメトリ用の OTLP プロトコルを設定します（`grpc` または `http`）。                                                                                                             |                                 | デフォルトは `grpc` です。詳細は [テレメトリ](/developers/development/telemetry) を参照してください。                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| `--telemetry-log-prompts`    |            | テレメトリ用にプロンプトのログ記録を有効にします。                                                                                                                               |                                 | 詳細は [テレメトリ](/developers/development/telemetry) を参照してください。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| `--checkpointing`            |            | [チェックポイント](../users/features/checkpointing) を有効にします。                                                                                                              |                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| `--extensions`               | `-e`       | セッションで使用する拡張機能のリストを指定します。                                                                                                                               | 拡張機能名                          | 指定しない場合、利用可能なすべての拡張機能が使用されます。特別なキーワード `qwen -e none` を使用してすべての拡張機能を無効にできます。例: `qwen -e my-extension -e my-other-extension`                                                                                                                                                                                                                                                                                                                                                                           |
| `--list-extensions`          | `-l`       | 利用可能なすべての拡張機能をリスト表示して終了します。                                                                                                                           |                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| `--proxy`                    |            | CLI のプロキシを設定します。                                                                                                                                                     | プロキシ URL                        | 例: `--proxy http://localhost:7890`。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| `--include-directories`      |            | マルチディレクトリ対応のためにワークスペースに追加のディレクトリを含めます。                                                                                                       | ディレクトリパス                    | 複数回指定するか、カンマ区切りの値として指定できます。最大 5 つのディレクトリを追加できます。例: `--include-directories /path/to/project1,/path/to/project2` または `--include-directories /path/to/project1 --include-directories /path/to/project2`                                                                                                                                                                                                                                                                                                         |
| `--screen-reader`            |            | スクリーンリーダーモードを有効にし、TUI をスクリーンリーダーとの互換性向上のために調整します。                                                                                     |                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| `--version`                  |            | CLI のバージョンを表示します。                                                                                                                                                   |                                 |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| `--openai-logging`           |            | OpenAI API 呼び出しのログ記録を有効にして、デバッグおよび分析を行います。                                                                                                         |                                 | このフラグは `settings.json` 内の `enableOpenAILogging` 設定を上書きします。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| `--openai-logging-dir`       |            | OpenAI API ログ用のカスタムディレクトリパスを設定します。                                                                                                                       | ディレクトリパス                    | このフラグは `settings.json` 内の `openAILoggingDir` 設定を上書きします。絶対パス、相対パス、および `~` 展開をサポートします。例: `qwen --openai-logging-dir "~/qwen-logs" --openai-logging`                                                                                                                                                                                                                                                                                                                                                                   |
| `--tavily-api-key`           |            | このセッションのウェブ検索機能用に Tavily API キーを設定します。                                                                                                                  | API キー                            | 例: `qwen --tavily-api-key tvly-your-api-key-here`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |

## コンテキストファイル（階層型指示コンテキスト）

CLI の*動作*の設定というよりは、コンテキストファイル（デフォルトでは `QWEN.md` ですが、`context.fileName` 設定で変更可能）は、*指示コンテキスト*（「メモリ」とも呼ばれます）の設定に不可欠です。この強力な機能により、プロジェクト固有の指示、コーディングスタイルガイド、または関連する背景情報を AI に提供し、ニーズに合わせて応答をより適切かつ正確にすることができます。CLI には、アクティブなコンテキストに関する情報を提供するために、フッターに読み込まれたコンテキストファイル数を表示するインジケーターなどの UI 要素が含まれています。

- **目的：** これらの Markdown ファイルには、Qwen モデルとのやり取り中に認識してほしい指示、ガイドライン、またはコンテキストが含まれています。システムは、この指示コンテキストを階層的に管理するように設計されています。

### コンテキストファイルの例（例：`QWEN.md`）

以下は、TypeScriptプロジェクトのルートにあるコンテキストファイルが含む内容の概念的な例です：

```

# プロジェクト: My Awesome TypeScript Library

## 一般的な指示:
- 新しいTypeScriptコードを生成する際は、既存のコーディングスタイルに従ってください。
- 新しい関数やクラスには、必ずJSDocコメントを付与してください。
- 適切な場所では、関数型プログラミングのパラダイムを優先してください。
- すべてのコードは、TypeScript 5.0およびNode.js 20以上で動作可能である必要があります。

## コーディングスタイル:
- インデントにはスペース2つを使用してください。
- インターフェース名の先頭には`I`を付けてください（例：`IUserService`）。
- クラスのプライベートメンバーの先頭にはアンダースコア（`_`）を付けてください。
- 常に厳密等価演算子（`===`と`!==`）を使用してください。

## 特定のコンポーネント: `src/api/client.ts`
- このファイルは、すべての外部APIリクエストを処理します。
- 新しいAPI呼び出し関数を追加する際は、堅牢なエラーハンドリングとログ出力を含めるようにしてください。
- GETリクエストには、既存の`fetchWithRetry`ユーティリティを使用してください。

## 依存関係について:
- 新しい外部依存関係の導入は、絶対に必要な場合を除き避けてください。
- 新しい依存関係が必要な場合は、その理由を明記してください。
```

この例では、プロジェクト全体のコンテキスト情報や特定のコーディング規約、特定ファイルやコンポーネントに関する注意点などをどのように提供するかを示しています。コンテキストファイルがどれだけ関連性があり正確であるかによって、AIがあなたをどの程度効果的に支援できるかが決まります。プロジェクト固有のコンテキストファイルを作成し、規約やコンテキストを確立することを強く推奨します。

- **階層的な読み込みと優先順位:** CLIは、複数の場所からコンテキストファイル（例：`QWEN.md`）を読み込むことで、洗練された階層型メモリシステムを実装しています。このリストで下位（より具体的な）ファイルからの内容は、通常、上位（より一般的な）ファイルからの内容を上書きまたは補完します。結合順序および最終的なコンテキストの詳細は、`/memory show` コマンドを使用して確認できます。典型的な読み込み順序は以下の通りです：
  1. **グローバルコンテキストファイル:**
     - 場所: `~/.qwen/<設定されたコンテキストファイル名>` （例：ユーザーのホームディレクトリにある `~/.qwen/QWEN.md`）。
     - 範囲: 全てのプロジェクトに対してデフォルトの指示を提供します。
  2. **プロジェクトルートおよび祖先ディレクトリのコンテキストファイル:**
     - 場所: CLIは現在の作業ディレクトリから親ディレクトリに向かって、`.git` フォルダで識別されるプロジェクトルートまたはホームディレクトリまで、設定されたコンテキストファイルを探します。
     - 範囲: プロジェクト全体またはその主要部分に関連するコンテキスト情報を提供します。
  3. **サブディレクトリのコンテキストファイル（コンテキスト的／ローカル）:**
     - 場所: CLIは現在の作業ディレクトリより下位のサブディレクトリにおいても、設定されたコンテキストファイルを検索します（`node_modules` や `.git` などの一般的な無視パターンを尊重）。この検索の広さはデフォルトで200ディレクトリに制限されていますが、`settings.json` ファイル内の `context.discoveryMaxDirs` 設定により変更可能です。
     - 範囲: 特定のコンポーネント、モジュール、またはプロジェクトの一部に対する非常に具体的な指示を可能にします。
- **結合とUI表示:** 見つかったすべてのコンテキストファイルの内容は結合され（元の場所とパスを示す区切り文字付き）、システムプロンプトの一部として提供されます。CLIのフッターには読み込まれたコンテキストファイル数が表示され、アクティブな指示コンテキストに関する視覚的な手がかりが得られます。
- **コンテンツのインポート:** `@path/to/file.md` 構文を使用して他のMarkdownファイルをインポートすることで、コンテキストファイルをモジュール化できます。詳しくは[Memory Import Processor ドキュメント](../users/configuration/memory)をご参照ください。
- **メモリ管理用コマンド:**
  - `/memory refresh` を使用すると、すべての設定済み場所からコンテキストファイルを強制的に再スキャン・再読み込みできます。これにより、AIの指示コンテキストが更新されます。
  - `/memory show` を使用すると、現在読み込まれている結合された指示コンテキストを表示でき、AIが使用している階層構造と内容を確認できます。
  - `/memory` コマンドおよびそのサブコマンド（`show` および `refresh`）の詳細については、[コマンドドキュメント](../users/reference/cli-reference)をご参照ください。

これらの設定レイヤーとコンテキストファイルの階層構造を理解し活用することで、AIのメモリを効果的に管理し、Qwen Codeの応答をあなたの特定のニーズやプロジェクトに合わせて調整することが可能になります。

## サンドボックス

Qwen Code は、システムを保護するために、サンドボックス環境内で潜在的に危険な操作（シェルコマンドやファイルの変更など）を実行できます。

[サンドボックス](../users/features/sandbox) はデフォルトでは無効になっていますが、以下の方法で有効にできます：

- `--sandbox` または `-s` フラグを使用する。
- `GEMINI_SANDBOX` 環境変数を設定する。
- `--yolo` または `--approval-mode=yolo` を使用する場合、デフォルトでサンドボックスが有効になります。

デフォルトでは、事前にビルドされた `qwen-code-sandbox` Docker イメージを使用します。

プロジェクト固有のサンドボックス要件がある場合は、プロジェクトのルートディレクトリに `.qwen/sandbox.Dockerfile` というカスタム Dockerfile を作成できます。この Dockerfile はベースとなるサンドボックスイメージを元にできます：

```
FROM qwen-code-sandbox

# ここにカスタムの依存関係や設定を追加してください

# 例：

# RUN apt-get update && apt-get install -y some-package
```

# COPY ./my-config /app/my-config
```

`.qwen/sandbox.Dockerfile` が存在する場合、Qwen Code を実行する際に `BUILD_SANDBOX` 環境変数を使用して、カスタムサンドボックスイメージを自動的にビルドできます：

```
BUILD_SANDBOX=1 qwen -s
```

## 使用統計情報

Qwen Code の改善のために、匿名化された使用統計情報を収集しています。このデータは、CLI の利用状況の把握、一般的な問題の特定、新機能の優先順位付けに役立てています。

**収集する情報:**

- **ツール呼び出し:** 呼び出されたツール名、成功または失敗の結果、実行時間などを記録します。ただし、ツールに渡される引数やツールから返されるデータは収集しません。
- **API リクエスト:** 各リクエストで使用されたモデル、リクエストの所要時間、成功したかどうかを記録します。プロンプトやレスポンスの内容は収集しません。
- **セッション情報:** 有効化されているツールや承認モードなど、CLI の設定に関する情報を収集します。

**収集しない情報:**

- **個人を特定できる情報（PII）:** 氏名、メールアドレス、API キーなど、個人を特定できる情報は一切収集しません。
- **プロンプトおよびレスポンスの内容:** ユーザーが入力したプロンプトやモデルからのレスポンスの内容は記録しません。
- **ファイルの内容:** CLI によって読み書きされたファイルの内容は記録しません。

**使用統計情報の送信をオプトアウトする方法:**

`settings.json` ファイル内の `privacy` カテゴリにある `usageStatisticsEnabled` プロパティを `false` に設定することで、いつでも使用統計情報の収集をオプトアウトできます：

```
{
  "privacy": {
    "usageStatisticsEnabled": false
  }
}
```

> [!note]
>
> 使用統計情報が有効になっている場合、イベントは Alibaba Cloud の RUM 収集エンドポイントに送信されます。