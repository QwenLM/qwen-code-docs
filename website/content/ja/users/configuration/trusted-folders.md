# 信頼済みフォルダ

信頼済みフォルダ機能は、Qwen Codeの全機能を使用できるプロジェクトを制御するセキュリティ設定です。CLIがプロジェクト固有の設定を読み込む前に、フォルダの承認を求めることで、悪意のあるコードが実行されるのを防ぎます。

## 機能の有効化

信頼済みフォルダ機能は**デフォルトでは無効**になっています。使用するには、まず設定で有効にする必要があります。

ユーザーの`settings.json`ファイルに以下を追加してください：

```json
{
  "security": {
    "folderTrust": {
      "enabled": true
    }
  }
}
```

## 仕組み: 信頼ダイアログ

機能が有効になると、フォルダから Qwen Code を初めて実行する際に、自動的にダイアログが表示され、選択を促されます：

- **フォルダを信頼**: 現在のフォルダ（例: `my-project`）を完全に信頼します。
- **親フォルダを信頼**: 親ディレクトリ（例: `safe-projects`）を信頼し、そのすべてのサブディレクトリも自動的に信頼されます。安全なプロジェクトを一箇所にまとめて管理している場合に便利です。
- **信頼しない**: フォルダを信頼しない状態としてマークします。CLI は制限付きの「セーフモード」で動作します。

選択内容は中心的なファイル（`~/.qwen/trustedFolders.json`）に保存されるため、各フォルダに対して一度だけ確認されます。

## 信頼が重要な理由: 信頼されていないワークスペースの影響

フォルダが**信頼されていない**場合、Qwen Code はユーザーを保護するために制限付きの「セーフモード」で実行されます。このモードでは以下の機能が無効になります：

1.  **ワークスペース設定が無視される**: CLI はプロジェクトから `.qwen/settings.json` ファイルをロード**しません**。これにより、カスタムツールやその他の潜在的に危険な設定の読み込みを防ぎます。

2.  **環境変数が無視される**: CLI はプロジェクトから `.env` ファイルをロード**しません**。

3.  **拡張機能の管理が制限される**: 拡張機能を**インストール、更新、アンインストールすることができません**。

4.  **ツールの自動承認が無効になる**: グローバルで自動承認が有効になっている場合でも、ツールを実行する前に常に確認メッセージが表示されます。

5.  **自動メモリ読み込みが無効になる**: CLI はローカル設定で指定されたディレクトリからファイルをコンテキストに自動的に読み込みません。

フォルダに信頼を付与することで、そのワークスペースにおける Qwen Code の全機能を利用できるようになります。

## 信頼設定の管理

決定を変更する必要がある場合や、すべての設定を確認したい場合は、いくつかのオプションがあります：

- **現在のフォルダの信頼を変更する**：CLI 内から `/permissions` コマンドを実行します。これにより同じインタラクティブなダイアログが表示され、現在のフォルダの信頼レベルを変更できます。

- **すべての信頼ルールを表示する**：信頼済みおよび非信頼フォルダのルールをすべて確認するには、ホームディレクトリにある `~/.qwen/trustedFolders.json` ファイルの中身を確認してください。

## 信頼チェックプロセス（上級者向け）

上級ユーザーにとって、信頼がどのように判断されるかの正確な処理順序を理解することは役立ちます：

1.  **IDE 信頼シグナル**：[IDE 統合](../ide-integration/ide-integration)を使用している場合、CLI はまず IDE にワークスペースが信頼されているかどうかを尋ねます。IDE の応答が最優先されます。

2.  **ローカル信頼ファイル**：IDE が接続されていない場合、CLI は中央の `~/.qwen/trustedFolders.json` ファイルをチェックします。