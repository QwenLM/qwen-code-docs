# 信頼済みフォルダ

信頼済みフォルダ機能は、Qwen Codeの全機能を利用できるプロジェクトをコントロールするためのセキュリティ設定です。CLIがプロジェクト固有の設定を読み込む前に、ユーザーがフォルダを承認する必要があるため、悪意のあるコードが実行されるのを防ぎます。

## 機能の有効化

信頼済みフォルダ機能は**デフォルトでは無効**になっています。この機能を使用するには、まず設定で有効にする必要があります。

ユーザーの`settings.json`ファイルに以下を追加してください：

```json
{
  "security": {
    "folderTrust": {
      "enabled": true
    }
  }
}
```

## 仕組み: 信頼ダイアログ

この機能が有効になると、フォルダから Qwen Code を初めて実行する際に自動的にダイアログが表示され、以下の選択肢から選ぶよう促されます：

- **Trust folder**: 現在のフォルダ（例: `my-project`）を完全に信頼します。
- **Trust parent folder**: 親ディレクトリ（例: `safe-projects`）を信頼し、そのすべてのサブディレクトリも自動的に信頼されます。安全なプロジェクトを一箇所にまとめて管理している場合に便利です。
- **Don't trust**: フォルダを信頼しない状態にします。CLI は制限付きの「セーフモード」で動作します。

選択内容は共通のファイル（`~/.qwen/trustedFolders.json`）に保存されるため、各フォルダに対してこの確認は一度だけ表示されます。

## 信頼が重要な理由：信頼されていないワークスペースの影響

フォルダが **信頼されていない** 場合、Qwen Code はユーザーを保護するために制限付きの「セーフモード」で実行されます。このモードでは、以下の機能が無効になります：

1.  **ワークスペース設定が無視される**：CLI はプロジェクト内の `.qwen/settings.json` ファイルを **読み込みません**。これにより、カスタムツールやその他の危険な可能性のある設定の読み込みを防ぎます。

2.  **環境変数が無視される**：CLI はプロジェクト内の `.env` ファイルを **読み込みません**。

3.  **拡張機能の管理が制限される**：拡張機能を **インストール、更新、アンインストールできません**。

4.  **ツールの自動承認が無効になる**：グローバルで自動承認を有効にしていた場合でも、ツールを実行する前に常に確認メッセージが表示されます。

5.  **自動メモリ読み込みが無効になる**：CLI はローカル設定で指定されたディレクトリからファイルを自動的にコンテキストに読み込みません。

フォルダに信頼を付与することで、そのワークスペースにおける Qwen Code の全機能を利用できるようになります。

## 信頼設定の管理

決定を変更する必要がある場合や、すべての設定を確認したい場合は、いくつかのオプションがあります：

- **現在のフォルダの信頼状態を変更する**：CLI内で `/permissions` コマンドを実行します。これにより同じインタラクティブなダイアログが表示され、現在のフォルダの信頼レベルを変更できます。

- **すべての信頼ルールを表示する**：信頼済みおよび非信頼フォルダのルールをすべて確認するには、ホームディレクトリにある `~/.qwen/trustedFolders.json` ファイルの中身を確認してください。

## 信頼チェックのプロセス（上級者向け）

上級ユーザーにとって、信頼がどのように判断されるかの正確な処理順序を理解することは役立ちます：

1.  **IDEからの信頼シグナル**：[IDE Integration](./ide-integration.md) を使用している場合、CLIはまずIDEにワークスペースが信頼されているかどうかを尋ねます。IDEの応答が最優先されます。

2.  **ローカルの信頼ファイル**：IDEが接続されていない場合、CLIは中央の `~/.qwen/trustedFolders.json` ファイルをチェックします。