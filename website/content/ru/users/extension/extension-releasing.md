# Публикация расширений

Существует два основных способа публикации расширений для пользователей:

- [Репозиторий Git](#публикация-через-репозиторий-git)
- [Github Releases](#публикация-через-github-releases)

Публикация через репозиторий Git, как правило, является самым простым и гибким подходом, в то время как публикация через GitHub может быть более эффективной при первоначальной установке, поскольку поставляются в виде отдельных архивов вместо выполнения git clone, который загружает каждый файл по отдельности. Github Releases также могут содержать архивы, специфичные для платформы, если вам нужно распространять бинарные файлы, специфичные для платформы.

## Публикация через репозиторий git

Это наиболее гибкий и простой вариант. Все, что вам нужно сделать, — это создать публично доступный репозиторий git (например, публичный репозиторий на GitHub), после чего пользователи смогут устанавливать ваше расширение с помощью команды `qwen extensions install <uri-адрес-вашего-репозитория>`, или для репозитория GitHub можно использовать упрощенный формат `qwen extensions install <организация>/<репозиторий>`. При необходимости они могут указать конкретную ссылку (ветку/тег/коммит), используя аргумент `--ref=<некоторая-ссылка>`, по умолчанию используется главная ветвь.

Когда коммиты отправляются в ссылку, от которой зависит пользователь, им будет предложено обновить расширение. Обратите внимание, что это также позволяет легко откатывать изменения: коммит HEAD всегда считается последней версией, независимо от фактической версии в файле `qwen-extension.json`.

### Управление каналами релизов с помощью репозитория git

Пользователи могут зависеть от любой ссылки из вашего репозитория git, например, ветки или тега, что позволяет управлять несколькими каналами релизов.

Например, вы можете поддерживать ветку `stable`, которую пользователи могут установить следующим образом: `qwen extensions install <your-repo-uri> --ref=stable`. Или вы можете сделать это значение по умолчанию, рассматривая вашу основную ветку как стабильную ветку релиза, а разработку вести в другой ветке (например, `dev`). Вы можете поддерживать столько веток или тегов, сколько захотите, обеспечивая максимальную гибкость для вас и ваших пользователей.

Обратите внимание, что эти аргументы `ref` могут быть тегами, ветками или даже конкретными коммитами, что позволяет пользователям зависеть от определенной версии вашего расширения. Как именно вы будете управлять тегами и ветками — решать вам.

### Пример процесса релизов с использованием репозитория Git

Хотя существует множество способов управления релизами с помощью git flow, мы рекомендуем рассматривать вашу ветку по умолчанию как ветку стабильных релизов. Это означает, что поведение по умолчанию для `qwen extensions install <your-repo-uri>` будет соответствовать ветке стабильных релизов.

Допустим, вы хотите поддерживать три стандартных канала релизов: `stable`, `preview` и `dev`. Всю обычную разработку вы будете выполнять в ветке `dev`. Когда вы готовы выпустить предварительную версию, вы объединяете эту ветку в свою ветку `preview`. Когда вы готовы продвинуть вашу ветку preview до стабильной версии, вы объединяете `preview` в вашу стабильную ветку (которая может быть вашей веткой по умолчанию или другой веткой).

Вы также можете переносить изменения из одной ветки в другую с помощью `git cherry-pick`, но имейте в виду, что это приведет к небольшому расхождению истории ваших веток, если вы не выполните принудительную отправку изменений в ваши ветки при каждом релизе, чтобы восстановить историю до чистого состояния (что может быть невозможно для ветки по умолчанию в зависимости от настроек вашего репозитория). Если вы планируете использовать cherry-pick, возможно, стоит избежать использования ветки по умолчанию в качестве стабильной ветки, чтобы избежать принудительной отправки в ветку по умолчанию, чего обычно следует избегать.

## Публикация через GitHub Releases

Расширения Qwen Code могут распространяться через [GitHub Releases](https://docs.github.com/en/repositories/releasing-projects-on-github/about-releases). Это обеспечивает более быструю и надежную установку для пользователей, избегая необходимости клонировать репозиторий.

Каждый выпуск включает по крайней мере один архивный файл, который содержит полное содержимое репозитория на момент тега, к которому он был привязан. Выпуски также могут включать [предварительно собранные архивы](#custom-pre-built-archives), если ваше расширение требует этапа сборки или имеет специфичные для платформы бинарные файлы.

При проверке обновлений qwen code будет искать последний выпуск на github (вы должны отметить его как таковой при создании выпуска), если только пользователь не установил конкретный выпуск, передав `--ref=<some-release-tag>`. В настоящее время мы не поддерживаем участие в предварительных выпусках или semver.

### Пользовательские предварительно собранные архивы

Пользовательские архивы должны быть прикреплены непосредственно к релизу на GitHub в качестве ассетов и должны быть полностью самодостаточными. Это означает, что они должны включать в себя все расширение целиком, см. [структура архива](#archive-structure).

Если ваше расширение не зависит от платформы, вы можете предоставить один общий ассет. В этом случае к релизу должен быть прикреплён только один ассет.

Пользовательские архивы также могут использоваться, если вы хотите разрабатывать своё расширение в более крупном репозитории. Вы можете создать архив, структура которого отличается от структуры самого репозитория (например, это может быть просто архив подкаталога, содержащего расширение).

#### Платформо-специфичные архивы

Чтобы обеспечить автоматический поиск Qwen Code правильного ресурса выпуска для каждой платформы, вы должны следовать этому соглашению об именовании. CLI будет искать ресурсы в следующем порядке:

1.  **Специфичные для платформы и архитектуры:** `{platform}.{arch}.{name}.{extension}`
2.  **Специфичные для платформы:** `{platform}.{name}.{extension}`
3.  **Общие:** Если предоставлен только один ресурс, он будет использоваться как общий запасной вариант.

- `{name}`: Имя вашего расширения.
- `{platform}`: Операционная система. Поддерживаемые значения:
  - `darwin` (macOS)
  - `linux`
  - `win32` (Windows)
- `{arch}`: Архитектура. Поддерживаемые значения:
  - `x64`
  - `arm64`
- `{extension}`: Расширение файла архива (например, `.tar.gz` или `.zip`).

**Примеры:**

- `darwin.arm64.my-tool.tar.gz` (специфичный для Mac на Apple Silicon)
- `darwin.my-tool.tar.gz` (для всех Mac)
- `linux.x64.my-tool.tar.gz`
- `win32.my-tool.zip`

#### Структура архива

Архивы должны представлять собой полностью самодостаточные расширения и соответствовать всем стандартным требованиям — в частности, файл `qwen-extension.json` должен находиться в корне архива.

Остальная часть структуры должна выглядеть точно так же, как у типичного расширения, см. [extensions.md](extension.md).

#### Пример рабочего процесса GitHub Actions

Вот пример рабочего процесса GitHub Actions, который собирает и выпускает расширение Qwen Code для нескольких платформ:

```yaml
name: Release Extension

on:
  push:
    tags:
      - 'v*'

jobs:
  release:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '20'

      - name: Install dependencies
        run: npm ci

      - name: Build extension
        run: npm run build

      - name: Create release assets
        run: |
          npm run package -- --platform=darwin --arch=arm64
          npm run package -- --platform=linux --arch=x64
          npm run package -- --platform=win32 --arch=x64

      - name: Create GitHub Release
        uses: softprops/action-gh-release@v1
        with:
          files: |
            release/darwin.arm64.my-tool.tar.gz
            release/linux.arm64.my-tool.tar.gz
            release/win32.arm64.my-tool.zip
```