# Начало работы с расширениями Qwen Code

Это руководство проведет вас через создание вашего первого расширения Qwen Code. Вы узнаете, как настроить новое расширение, добавить пользовательский инструмент через сервер MCP, создать пользовательскую команду и предоставить контекст модели с помощью файла `QWEN.md`.

## Предварительные требования

Прежде чем начать, убедитесь, что у вас установлен Qwen Code и вы имеете базовое понимание Node.js и TypeScript.

## Шаг 1: Создание нового расширения

Самый простой способ начать — использовать один из встроенных шаблонов. Мы будем использовать пример `mcp-server` в качестве нашей основы.

Выполните следующую команду, чтобы создать новый каталог с названием `my-first-extension` с файлами шаблона:

```bash
qwen extensions new my-first-extension mcp-server
```

Будет создан новый каталог со следующей структурой:

```
my-first-extension/
├── example.ts
├── qwen-extension.json
├── package.json
└── tsconfig.json
```

## Шаг 2: Изучите файлы расширения

Давайте рассмотрим ключевые файлы в вашем новом расширении.

### `qwen-extension.json`

Это файл манифеста для вашего расширения. Он сообщает Qwen Code, как загружать и использовать ваше расширение.

```json
{
  "name": "my-first-extension",
  "version": "1.0.0",
  "mcpServers": {
    "nodeServer": {
      "command": "node",
      "args": ["${extensionPath}${/}dist${/}example.js"],
      "cwd": "${extensionPath}"
    }
  }
}
```

- `name`: Уникальное имя вашего расширения.
- `version`: Версия вашего расширения.
- `mcpServers`: Этот раздел определяет один или несколько серверов протокола контекста модели (Model Context Protocol, MCP). Серверы MCP — это способ добавления новых инструментов, которые может использовать модель.
  - `command`, `args`, `cwd`: Эти поля указывают, как запустить ваш сервер. Обратите внимание на использование переменной `${extensionPath}`, которую Qwen Code заменяет абсолютным путем к каталогу установки вашего расширения. Это позволяет вашему расширению работать независимо от места его установки.

### `example.ts`

Этот файл содержит исходный код для вашего сервера MCP. Это простой сервер Node.js, который использует `@modelcontextprotocol/sdk`.

```typescript
/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */

import { McpServer } from '@modelcontextprotocol/sdk/server/mcp.js';
import { StdioServerTransport } from '@modelcontextprotocol/sdk/server/stdio.js';
import { z } from 'zod';

const server = new McpServer({
  name: 'prompt-server',
  version: '1.0.0',
});

// Регистрирует новый инструмент с именем 'fetch_posts'
server.registerTool(
  'fetch_posts',
  {
    description: 'Получает список постов из публичного API.',
    inputSchema: z.object({}).shape,
  },
  async () => {
    const apiResponse = await fetch(
      'https://jsonplaceholder.typicode.com/posts',
    );
    const posts = await apiResponse.json();
    const response = { posts: posts.slice(0, 5) };
    return {
      content: [
        {
          type: 'text',
          text: JSON.stringify(response),
        },
      ],
    };
  },
);

// ... (регистрация подсказок опущена для краткости)

const transport = new StdioServerTransport();
await server.connect(transport);
```

Этот сервер определяет один инструмент с именем `fetch_posts`, который получает данные из публичного API.

### `package.json` и `tsconfig.json`

Это стандартные файлы конфигурации для проекта TypeScript. Файл `package.json` определяет зависимости и скрипт `build`, а `tsconfig.json` настраивает компилятор TypeScript.

## Шаг 3: Сборка и подключение расширения

Прежде чем вы сможете использовать расширение, необходимо скомпилировать код TypeScript и связать расширение с вашей локальной установкой Qwen Code для разработки.

1.  **Установите зависимости:**

    ```bash
    cd my-first-extension
    npm install
    ```

2.  **Соберите сервер:**

    ```bash
    npm run build
    ```

    Это скомпилирует `example.ts` в `dist/example.js`, который является файлом, на который ссылается ваш `qwen-extension.json`.

3.  **Подключите расширение:**

    Команда `link` создает символическую ссылку из каталога расширений Qwen Code в ваш каталог разработки. Это означает, что любые изменения, которые вы внесете, будут отражаться немедленно, без необходимости переустановки.

    ```bash
    qwen extensions link .
    ```

Теперь перезапустите сеанс Qwen Code. Новый инструмент `fetch_posts` будет доступен. Вы можете протестировать его, спросив: "fetch posts".

## Шаг 4: Добавление пользовательской команды

Пользовательские команды позволяют создавать ярлыки для сложных запросов. Давайте добавим команду, которая будет искать шаблон в вашем коде.

1.  Создайте каталог `commands` и подкаталог для вашей группы команд:

    ```bash
    mkdir -p commands/fs
    ```

2.  Создайте файл с именем `commands/fs/grep-code.md`:

    ```markdown
    ---
    description: Поиск шаблона в коде и резюмирование результатов
    ---

    Пожалуйста, суммируйте результаты по шаблону `{{args}}`.

    Результаты поиска:
    !{grep -r {{args}} .}
    ```

    Эта команда `/fs:grep-code` будет принимать аргумент, запускать команду оболочки `grep` с ним и передавать результаты в запрос для резюмирования.

> **Примечание:** Команды используют формат Markdown с необязательным YAML frontmatter. Формат TOML устарел, но все еще поддерживается для обратной совместимости.

После сохранения файла перезапустите Qwen Code. Теперь вы можете выполнить `/fs:grep-code "some pattern"`, чтобы использовать вашу новую команду.

## Шаг 5: Добавление пользовательских навыков и субагентов (опционально)

Расширения также могут предоставлять пользовательские навыки и субагенты для расширения возможностей Qwen Code.

### Добавление пользовательского навыка

Навыки — это вызываемые моделью возможности, которые ИИ может автоматически использовать при необходимости.

1.  Создайте каталог `skills` с подкаталогом навыка:

    ```bash
    mkdir -p skills/code-analyzer
    ```

2.  Создайте файл `skills/code-analyzer/SKILL.md`:

    ```markdown
    ---
    name: code-analyzer
    description: Анализирует структуру кода и предоставляет информацию о сложности, зависимостях и потенциальных улучшениях
    ---

    # Анализатор кода

    ## Инструкции

    При анализе кода сосредоточьтесь на:

    - Сложности кода и удобстве сопровождения
    - Зависимостях и связывании
    - Потенциальных проблемах с производительностью
    - Предложениях по улучшению

    ## Примеры

    - "Проанализируй сложность этой функции"
    - "Какие зависимости у этого модуля?"
    ```

### Добавление пользовательского субагента

Субагенты — это специализированные помощники ИИ для конкретных задач.

1.  Создайте каталог `agents`:

    ```bash
    mkdir -p agents
    ```

2.  Создайте файл `agents/refactoring-expert.md`:

    ```markdown
    ---
    name: refactoring-expert
    description: Специализируется на рефакторинге кода, улучшении структуры и сопровождаемости кода
    tools:
      - read_file
      - write_file
      - read_many_files
    ---

    Вы являетесь специалистом по рефакторингу, сосредоточенным на повышении качества кода.

    Ваши навыки включают:

    - Определение запахов кода и антипаттернов
    - Применение принципов SOLID
    - Повышение читаемости и сопровождаемости кода
    - Безопасный рефакторинг с минимальным риском

    Для каждой задачи рефакторинга:

    1. Проанализируйте текущую структуру кода
    2. Определите области для улучшения
    3. Предложите шаги по рефакторингу
    4. Реализуйте изменения постепенно
    5. Убедитесь, что функциональность сохранена
    ```

После перезапуска Qwen Code ваши пользовательские навыки будут доступны через `/skills`, а субагенты — через `/agents manage`.

## Шаг 6: Добавьте пользовательский файл `QWEN.md`

Вы можете предоставить модели постоянный контекст, добавив файл `QWEN.md` в ваше расширение. Это полезно для предоставления модели инструкций о том, как вести себя, или информации об инструментах вашего расширения. Обратите внимание, что вам не всегда это нужно для расширений, созданных для предоставления команд и подсказок.

1.  Создайте файл с именем `QWEN.md` в корне директории вашего расширения:

    ```markdown
    # Инструкции к моему первому расширению

    Вы являетесь экспертом-помощником разработчика. Когда пользователь просит вас получить посты, используйте инструмент `fetch_posts`. Будьте краткими в своих ответах.
    ```

2.  Обновите ваш `qwen-extension.json`, чтобы сообщить CLI о необходимости загрузки этого файла:

    ```json
    {
      "name": "my-first-extension",
      "version": "1.0.0",
      "contextFileName": "QWEN.md",
      "mcpServers": {
        "nodeServer": {
          "command": "node",
          "args": ["${extensionPath}${/}dist${/}example.js"],
          "cwd": "${extensionPath}"
        }
      }
    }
    ```

Снова перезапустите CLI. Теперь модель будет иметь контекст из вашего файла `QWEN.md` в каждой сессии, где активно расширение.

## Шаг 7: Публикация расширения

Как только вы будете довольны своим расширением, вы можете поделиться им с другими. Основные способы публикации расширений — через репозиторий Git или через GitHub Releases. Использование публичного репозитория Git является самым простым методом.

Подробные инструкции по обоим методам см. в [Руководстве по публикации расширений](extension-releasing.md).

## Заключение

Вы успешно создали расширение для Qwen Code! Вы узнали, как:

- Создавать новое расширение из шаблона.
- Добавлять пользовательские инструменты с помощью сервера MCP.
- Создавать удобные пользовательские команды.
- Добавлять пользовательские навыки и субагенты.
- Предоставлять модели постоянный контекст.
- Подключать ваше расширение для локальной разработки.

Теперь вы можете изучать более продвинутые возможности и создавать мощные новые функции для Qwen Code.