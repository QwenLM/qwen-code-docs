# Устранение неполадок

Это руководство содержит решения для распространенных проблем и советы по отладке, включая следующие темы:

- Ошибки аутентификации или входа в систему
- Часто задаваемые вопросы (FAQ)
- Советы по отладке
- Существующие задачи на GitHub, похожие на вашу проблему, или создание новых задач

## Ошибки аутентификации или входа

- **Ошибка: `UNABLE_TO_GET_ISSUER_CERT_LOCALLY` или `unable to get local issuer certificate`**
  - **Причина:** Вы можете находиться в корпоративной сети с брандмауэром, который перехватывает и проверяет SSL/TLS-трафик. Для этого часто требуется доверять пользовательскому корневому сертификату ЦС, установленному в Node.js.
  - **Решение:** Установите переменную окружения `NODE_EXTRA_CA_CERTS`, указав абсолютный путь к файлу корневого сертификата вашего корпоративного ЦС.
    - Пример: `export NODE_EXTRA_CA_CERTS=/path/to/your/corporate-ca.crt`

- **Проблема: Не удается отобразить интерфейс после ошибки аутентификации**
  - **Причина:** Если аутентификация завершается неудачей после выбора типа аутентификации, параметр `security.auth.selectedType` может сохраниться в файле `settings.json`. При перезапуске CLI может зависнуть при попытке аутентификации через неудачный тип и не отобразить интерфейс.
  - **Решение:** Очистите элемент конфигурации `security.auth.selectedType` в вашем файле `settings.json`:
    - Откройте `~/.qwen/settings.json` (или `./.qwen/settings.json` для настроек конкретного проекта)
    - Удалите поле `security.auth.selectedType`
    - Перезапустите CLI, чтобы снова получить запрос на аутентификацию

## Часто задаваемые вопросы (FAQ)

- **В: Как обновить Qwen Code до последней версии?**
  - О: Если вы установили его глобально через `npm`, обновите его с помощью команды `npm install -g @qwen-code/qwen-code@latest`. Если вы скомпилировали его из исходного кода, извлеките последние изменения из репозитория, а затем пересоберите с помощью команды `npm run build`.

- **В: Где хранятся файлы конфигурации или настроек Qwen Code?**
  - О: Конфигурация Qwen Code хранится в двух файлах `settings.json`:
    1. В вашем домашнем каталоге: `~/.qwen/settings.json`.
    2. В корневом каталоге вашего проекта: `./.qwen/settings.json`.

    Дополнительную информацию см. в разделе [Конфигурация Qwen Code](/users/configuration/settings).

- **В: Почему я не вижу кэшированных подсчетов токенов в выводе статистики?**
  - О: Информация о кэшированных токенах отображается только при использовании кэшированных токенов. Эта функция доступна для пользователей ключей API (ключ Qwen API или Google Cloud Vertex AI), но недоступна для пользователей OAuth (например, личных/корпоративных аккаунтов Google, таких как Google Gmail или Google Workspace соответственно). Это связано с тем, что API Qwen Code Assist не поддерживает создание кэшированного контента. Вы по-прежнему можете просматривать общее использование токенов с помощью команды `/stats`.

## Распространенные сообщения об ошибках и решения

- **Ошибка: `EADDRINUSE` (Адрес уже используется) при запуске сервера MCP.**
  - **Причина:** Другой процесс уже использует порт, к которому пытается привязаться сервер MCP.
  - **Решение:**
    Остановите другой процесс, использующий этот порт, или настройте сервер MCP для использования другого порта.

- **Ошибка: Команда не найдена (при попытке запустить Qwen Code с помощью `qwen`).**
  - **Причина:** CLI не установлен корректно или не добавлен в переменную окружения `PATH` вашей системы.
  - **Решение:**
    Способ обновления зависит от того, как вы установили Qwen Code:
    - Если вы установили `qwen` глобально, убедитесь, что директория глобальных бинарных файлов `npm` находится в вашем `PATH`. Вы можете обновить его с помощью команды `npm install -g @qwen-code/qwen-code@latest`.
    - Если вы запускаете `qwen` из исходного кода, убедитесь, что используете правильную команду для его вызова (например, `node packages/cli/dist/index.js ...`). Чтобы обновить, получите последние изменения из репозитория и пересоберите проект с помощью команды `npm run build`.

- **Ошибка: `MODULE_NOT_FOUND` или ошибки импорта.**
  - **Причина:** Зависимости установлены некорректно или проект не был собран.
  - **Решение:**
    1.  Выполните `npm install`, чтобы убедиться, что все зависимости установлены.
    2.  Выполните `npm run build`, чтобы скомпилировать проект.
    3.  Убедитесь, что сборка прошла успешно, выполнив `npm run start`.

- **Ошибка: "Operation not permitted", "Permission denied" или аналогичные.**
  - **Причина:** Когда включено песочницу, Qwen Code может пытаться выполнить операции, которые ограничены вашей конфигурацией песочницы, например, запись вне каталога проекта или системной временной директории.
  - **Решение:** Обратитесь к документации [Конфигурация: Песочница](/users/features/sandbox) для получения дополнительной информации, включая способы настройки конфигурации песочницы.

- **Qwen Code не работает в интерактивном режиме в средах "CI"**
  - **Проблема:** Qwen Code не переходит в интерактивный режим (не появляется приглашение), если установлена переменная окружения, начинающаяся с префикса `CI_` (например, `CI_TOKEN`). Это связано с тем, что пакет `is-in-ci`, используемый базовым фреймворком пользовательского интерфейса, обнаруживает такие переменные и предполагает, что это неинтерактивная среда CI.
  - **Причина:** Пакет `is-in-ci` проверяет наличие переменных `CI`, `CONTINUOUS_INTEGRATION` или любых переменных с префиксом `CI_`. При обнаружении любой из них он сигнализирует, что среда является неинтерактивной, что препятствует запуску CLI в интерактивном режиме.
  - **Решение:** Если переменная с префиксом `CI_` не требуется для работы CLI, вы можете временно удалить её перед выполнением команды. Например: `env -u CI_TOKEN qwen`

- **Режим DEBUG не работает из файла .env проекта**
  - **Проблема:** Установка `DEBUG=true` в файле `.env` проекта не активирует режим отладки для CLI.
  - **Причина:** Переменные `DEBUG` и `DEBUG_MODE` автоматически исключаются из файлов `.env` проекта, чтобы не мешать работе CLI.
  - **Решение:** Вместо этого используйте файл `.qwen/.env` или настройте параметр `advanced.excludedEnvVars` в вашем `settings.json`, чтобы исключить меньше переменных.

## IDE Companion не подключается

- Убедитесь, что в VS Code открыт только один каталог рабочей области.
- Перезапустите встроенный терминал после установки расширения, чтобы он унаследовал переменные:
  - `QWEN_CODE_IDE_WORKSPACE_PATH`
  - `QWEN_CODE_IDE_SERVER_PORT`
- Если вы работаете внутри контейнера, проверьте, что `host.docker.internal` разрешается. В противном случае настройте соответствующее сетевое сопоставление с хостом.
- Переустановите компаньон с помощью команды `/ide install` и используйте «Qwen Code: Run» из палитры команд, чтобы убедиться, что он запускается.

## Коды завершения

Qwen Code использует определенные коды завершения для указания причины прекращения работы. Это особенно полезно при написании скриптов и автоматизации.

| Код завершения | Тип ошибки                  | Описание                                                     |
| -------------- | --------------------------- | ------------------------------------------------------------ |
| 41             | `FatalAuthenticationError`  | Произошла ошибка в процессе аутентификации.                  |
| 42             | `FatalInputError`           | Были предоставлены недопустимые или отсутствующие входные данные для CLI. (только в неинтерактивном режиме) |
| 44             | `FatalSandboxError`         | Произошла ошибка с изолированной средой выполнения (например, Docker, Podman или Seatbelt). |
| 52             | `FatalConfigError`          | Файл конфигурации (`settings.json`) является недопустимым или содержит ошибки. |
| 53             | `FatalTurnLimitedError`     | Достигнуто максимальное количество шагов диалога для текущей сессии. (только в неинтерактивном режиме) |

## Советы по отладке

- **Отладка CLI:**
  - Используйте флаг `--verbose` (если доступен) с командами CLI для получения более подробного вывода.
  - Проверьте логи CLI, которые часто находятся в пользовательской директории конфигурации или кэша.

- **Отладка ядра:**
  - Проверьте вывод консоли сервера на наличие сообщений об ошибках или трассировок стека.
  - Увеличьте уровень детализации логов, если это настраивается.
  - Используйте инструменты отладки Node.js (например, `node --inspect`), если вам нужно пройти пошагово через код на стороне сервера.

- **Проблемы с инструментами:**
  - Если конкретный инструмент не работает, попробуйте изолировать проблему, запустив самую простую возможную версию команды или операции, которую выполняет инструмент.
  - Для `run_shell_command` проверьте, что команда работает напрямую в вашем шелле.
  - Для _инструментов файловой системы_ убедитесь, что пути указаны правильно, и проверьте права доступа.

- **Предварительные проверки:**
  - Всегда запускайте `npm run preflight` перед коммитом кода. Это может выявить множество распространенных проблем, связанных с форматированием, линтингом и ошибками типов.

## Существующие проблемы на GitHub, похожие на вашу, или создание новых проблем

Если вы столкнулись с проблемой, которая не описана в этом _руководстве по устранению неполадок_, попробуйте поискать в [трекере проблем Qwen Code на GitHub](https://github.com/QwenLM/qwen-code/issues). Если вы не можете найти проблему, похожую на вашу, подумайте о создании новой проблемы на GitHub с подробным описанием. Пулл-реквесты также приветствуются!