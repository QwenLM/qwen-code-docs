# Руководство по устранению неполадок

Это руководство содержит решения для часто возникающих проблем и советы по отладке, включая следующие темы:

- Ошибки аутентификации или входа в систему
- Часто задаваемые вопросы (FAQ)
- Советы по отладке
- Существующие Issues в GitHub, похожие на вашу проблему, или создание новых Issues

## Ошибки аутентификации или входа в систему

- **Ошибка: `Failed to login. Message: Request contains an invalid argument`**
  - Пользователи с аккаунтами Google Workspace или Google Cloud, связанными с их аккаунтами Gmail, могут не иметь возможности активировать бесплатный тарифный план Google Code Assist.
  - Для аккаунтов Google Cloud эту проблему можно обойти, установив переменную окружения `GOOGLE_CLOUD_PROJECT` равной ID вашего проекта.
  - Также вы можете получить API-ключ Gemini из [Google AI Studio](http://aistudio.google.com/app/apikey), который также включает отдельный бесплатный лимит.

- **Ошибка: `UNABLE_TO_GET_ISSUER_CERT_LOCALLY` или `unable to get local issuer certificate`**
  - **Причина:** Возможно, вы находитесь в корпоративной сети с брандмауэром, который перехватывает и инспектирует SSL/TLS-трафик. Для этого часто требуется, чтобы Node.js доверял пользовательскому корневому сертификату ЦС.
  - **Решение:** Установите переменную окружения `NODE_EXTRA_CA_CERTS`, указав абсолютный путь к файлу корневого сертификата вашей корпоративной ЦС.
    - Пример: `export NODE_EXTRA_CA_CERTS=/path/to/your/corporate-ca.crt`

## Часто задаваемые вопросы (FAQ)

- **В: Как обновить Qwen Code до последней версии?**
  - О: Если вы установили его глобально через `npm`, обновите его с помощью команды `npm install -g @qwen-code/qwen-code@latest`. Если вы скомпилировали его из исходного кода, извлеките последние изменения из репозитория, а затем пересоберите с помощью команды `npm run build`.

- **В: Где хранятся файлы конфигурации или настроек Qwen Code?**
  - О: Конфигурация Qwen Code хранится в двух файлах `settings.json`:
    1. В вашем домашнем каталоге: `~/.qwen/settings.json`.
    2. В корневом каталоге вашего проекта: `./.qwen/settings.json`.

    Дополнительную информацию см. в разделе [Конфигурация Qwen Code](./cli/configuration.md).

- **В: Почему я не вижу кэшированных подсчетов токенов в выводе статистики?**
  - О: Информация о кэшированных токенах отображается только тогда, когда используются кэшированные токены. Эта функция доступна для пользователей API-ключей (Gemini API key или Google Cloud Vertex AI), но недоступна для пользователей OAuth (например, личных/корпоративных аккаунтов Google, таких как Google Gmail или Google Workspace соответственно). Это связано с тем, что Gemini Code Assist API не поддерживает создание кэшированного контента. Вы по-прежнему можете просматривать общее использование токенов с помощью команды `/stats`.

## Распространенные сообщения об ошибках и решения

- **Ошибка: `EADDRINUSE` (Address already in use) при запуске MCP сервера.**
  - **Причина:** Другой процесс уже использует порт, к которому пытается привязаться MCP сервер.
  - **Решение:**
    Остановите другой процесс, использующий этот порт, или настройте MCP сервер на использование другого порта.

- **Ошибка: Command not found (при попытке запустить Qwen Code с помощью `qwen`).**
  - **Причина:** CLI не установлен корректно или не добавлен в `PATH` вашей системы.
  - **Решение:**
    Способ обновления зависит от того, как вы установили Qwen Code:
    - Если вы установили `qwen` глобально, проверьте, что директория с глобальными бинарниками `npm` находится в вашем `PATH`. Вы можете обновить с помощью команды `npm install -g @qwen-code/qwen-code@latest`.
    - Если вы запускаете `qwen` из исходников, убедитесь, что используете правильную команду для запуска (например, `node packages/cli/dist/index.js ...`). Чтобы обновить, сделайте pull последних изменений из репозитория и пересоберите проект командой `npm run build`.

- **Ошибка: `MODULE_NOT_FOUND` или ошибки импорта.**
  - **Причина:** Зависимости установлены некорректно или проект не был собран.
  - **Решение:**
    1.  Выполните `npm install`, чтобы убедиться, что все зависимости установлены.
    2.  Выполните `npm run build`, чтобы скомпилировать проект.
    3.  Убедитесь, что сборка прошла успешно, с помощью `npm run start`.

- **Ошибка: "Operation not permitted", "Permission denied" или аналогичные.**
  - **Причина:** Если включён sandboxing, Qwen Code может пытаться выполнить операции, запрещённые вашей конфигурацией песочницы, например, запись вне директории проекта или системной временной директории.
  - **Решение:** Обратитесь к документации [Configuration: Sandboxing](./cli/configuration.md#sandboxing) для получения дополнительной информации, включая способы настройки конфигурации песочницы.

- **Qwen Code не запускается в интерактивном режиме в CI-средах**
  - **Проблема:** Qwen Code не переходит в интерактивный режим (не появляется приглашение ввода), если установлена переменная окружения, начинающаяся с `CI_` (например, `CI_TOKEN`). Это происходит потому, что пакет `is-in-ci`, используемый в UI-фреймворке, определяет такие переменные как признак неинтерактивной CI-среды.
  - **Причина:** Пакет `is-in-ci` проверяет наличие переменных `CI`, `CONTINUOUS_INTEGRATION` или любых переменных с префиксом `CI_`. При обнаружении хотя бы одной из них он считает, что среда неинтерактивна, и CLI не запускается в интерактивном режиме.
  - **Решение:** Если переменная с префиксом `CI_` не требуется для работы CLI, её можно временно отключить при запуске команды. Например: `env -u CI_TOKEN qwen`

- **DEBUG режим не работает при установке через .env файл проекта**
  - **Проблема:** Установка `DEBUG=true` в `.env` файле проекта не включает режим отладки для CLI.
  - **Причина:** Переменные `DEBUG` и `DEBUG_MODE` автоматически исключаются из `.env` файлов проекта, чтобы не мешать работе CLI.
  - **Решение:** Используйте файл `.qwen/.env` вместо этого, или настройте параметр `excludedProjectEnvVars` в вашем `settings.json`, чтобы исключить меньше переменных.

## IDE Companion не подключается

- Убедитесь, что в VS Code открыт только один workspace folder.
- Перезапустите встроенный терминал после установки расширения, чтобы он унаследовал переменные:
  - `QWEN_CODE_IDE_WORKSPACE_PATH`
  - `QWEN_CODE_IDE_SERVER_PORT`
- Если вы работаете в контейнере, проверьте, что `host.docker.internal` резолвится. В противном случае, настройте соответствующий маппинг хоста.
- Переустановите companion с помощью `/ide install` и используйте команду “Qwen Code: Run” из Command Palette, чтобы проверить запуск.

## Советы по отладке

- **Отладка CLI:**
  - Используйте флаг `--verbose` (если доступен) с командами CLI для получения более подробного вывода.
  - Проверьте логи CLI, которые часто находятся в пользовательской директории конфигурации или кэша.

- **Отладка ядра:**
  - Проверьте вывод консоли сервера на наличие сообщений об ошибках или stack trace.
  - Увеличьте уровень детализации логов, если это настраивается.
  - Используйте инструменты отладки Node.js (например, `node --inspect`), если нужно пошагово пройти по серверному коду.

- **Проблемы с инструментами:**
  - Если конкретный инструмент не работает, попробуйте изолировать проблему, запустив самую простую возможную версию команды или операции, которую выполняет инструмент.
  - Для `run_shell_command` сначала проверьте, что команда работает напрямую в вашем shell.
  - Для _инструментов файловой системы_ убедитесь, что пути указаны правильно, и проверьте права доступа.

- **Предварительные проверки:**
  - Всегда запускайте `npm run preflight` перед коммитом кода. Это позволяет выявить многие распространенные проблемы, связанные с форматированием, линтингом и ошибками типов.

## Существующие GitHub Issues, похожие на вашу проблему, или создание новых Issues

Если вы столкнулись с проблемой, которая не описана в этом _руководстве по устранению неполадок_, попробуйте поискать в [Issue tracker на GitHub](https://github.com/QwenLM/qwen-code/issues) проекта Qwen Code. Если вы не можете найти похожую проблему, рекомендуем создать новый GitHub Issue с подробным описанием. Pull request также приветствуются!