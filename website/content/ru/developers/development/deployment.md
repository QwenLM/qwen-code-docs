# Выполнение и развертывание Qwen Code

В этом документе описано, как запустить Qwen Code, и объясняется архитектура развертывания, которую использует Qwen Code.

## Запуск Qwen Code

Существует несколько способов запустить Qwen Code. Выбранный вами вариант зависит от того, как вы собираетесь его использовать.

---

### 1. Стандартная установка (Рекомендуется для обычных пользователей)

Это рекомендуемый способ установки Qwen Code для конечных пользователей. Он включает загрузку пакета Qwen Code из реестра NPM.

- **Глобальная установка:**

  ```bash
  npm install -g @qwen-code/qwen-code
  ```

  Затем запустите CLI из любого места:

  ```bash
  qwen
  ```

- **Выполнение через NPX:**

  ```bash
  # Выполнить последнюю версию из NPM без глобальной установки
  npx @qwen-code/qwen-code
  ```

---

### 2. Запуск в песочнице (Docker/Podman)

Для обеспечения безопасности и изоляции Qwen Code можно запускать внутри контейнера. Это способ по умолчанию, который использует CLI для выполнения инструментов, которые могут иметь побочные эффекты.

- **Непосредственно из реестра:**
  Вы можете запустить опубликованный образ песочницы напрямую. Это полезно в средах, где у вас есть только Docker и вы хотите запустить CLI.
  ```bash
  # Запустить опубликованный образ песочницы
  docker run --rm -it ghcr.io/qwenlm/qwen-code:0.0.11
  ```
- **Использование флага `--sandbox`:**
  Если у вас локально установлен Qwen Code (с использованием стандартной установки, описанной выше), вы можете указать ему запускаться внутри контейнера песочницы.
  ```bash
  qwen --sandbox -y -p "ваш запрос здесь"
  ```

---

### 3. Запуск из исходного кода (Рекомендуется для участников проекта Qwen Code)

Участникам проекта может потребоваться запустить CLI непосредственно из исходного кода.

- **Режим разработки:**
  Этот метод обеспечивает горячую перезагрузку и удобен при активной разработке.
  ```bash
  # Из корня репозитория
  npm run start
  ```
- **Режим, близкий к production (связанный пакет):**
  Этот метод имитирует глобальную установку путем связывания вашего локального пакета. Полезно для тестирования локальной сборки в рабочем процессе.

  ```bash
  # Свяжите локальный пакет cli с вашими глобальными node_modules
  npm link packages/cli

  # Теперь вы можете запустить свою локальную версию с помощью команды `qwen`
  qwen
  ```

---

### 4. Запуск последнего коммита Qwen Code с GitHub

Вы можете запустить самую последнюю зафиксированную версию Qwen Code прямо из репозитория на GitHub. Это удобно для тестирования функций, находящихся в разработке.

```bash

# Выполнение CLI непосредственно из основной ветки на GitHub
npx https://github.com/QwenLM/qwen-code
```

## Архитектура развертывания

Описанные выше методы выполнения становятся возможными благодаря следующим архитектурным компонентам и процессам:

**Пакеты NPM**

Проект Qwen Code представляет собой монорепозиторий, который публикует основные пакеты в реестре NPM:

- `@qwen-code/qwen-code-core`: Бэкенд, обрабатывающий логику и выполнение инструментов.
- `@qwen-code/qwen-code`: Фронтенд, ориентированный на пользователя.

Эти пакеты используются при выполнении стандартной установки и при запуске Qwen Code из исходного кода.

**Процессы сборки и упаковки**

Используются два различных процесса сборки в зависимости от канала распространения:

- **Публикация в NPM:** Для публикации в реестре NPM исходный код TypeScript в `@qwen-code/qwen-code-core` и `@qwen-code/qwen-code` транспилируется в стандартный JavaScript с использованием компилятора TypeScript (`tsc`). Полученный каталог `dist/` публикуется в пакете NPM. Это стандартный подход для библиотек TypeScript.

- **Выполнение через `npx` из GitHub:** При запуске последней версии Qwen Code непосредственно из GitHub запускается другой процесс, инициируемый скриптом `prepare` в `package.json`. Этот скрипт использует `esbuild` для объединения всего приложения и его зависимостей в один автономный файл JavaScript. Этот бандл создается на лету на компьютере пользователя и не добавляется в репозиторий.

**Образ песочницы Docker**

Метод выполнения на основе Docker поддерживается образом контейнера `qwen-code-sandbox`. Этот образ публикуется в реестре контейнеров и содержит предустановленную глобальную версию Qwen Code.

## Процесс релиза

Процесс релиза автоматизирован с помощью GitHub Actions. Рабочий процесс релиза выполняет следующие действия:

1.  Собирает NPM-пакеты с использованием `tsc`.
2.  Публикует NPM-пакеты в реестре артефактов.
3.  Создает релизы GitHub с приложенными ресурсами.