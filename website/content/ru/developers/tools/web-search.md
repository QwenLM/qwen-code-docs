# Инструмент веб-поиска (`web_search`)

В этом документе описывается инструмент `web_search` для выполнения веб-поиска с использованием нескольких провайдеров.

## Описание

Используйте `web_search` для выполнения веб-поиска и получения информации из интернета. Инструмент поддерживает несколько поисковых провайдеров и возвращает краткий ответ с указанием источников, когда это возможно.

### Поддерживаемые провайдеры

1. **DashScope** (официальный, бесплатный) - автоматически доступен для пользователей Qwen OAuth (200 запросов/минуту, 2000 запросов/день)
2. **Tavily** - высококачественный поисковый API со встроенной генерацией ответов
3. **Google Custom Search** - JSON API пользовательского поиска Google

### Аргументы

`web_search` принимает два аргумента:

- `query` (строка, обязательный): Поисковый запрос
- `provider` (строка, необязательный): Конкретный провайдер для использования ("dashscope", "tavily", "google")
  - Если не указан, используется провайдер по умолчанию из конфигурации

## Конфигурация

### Метод 1: Файл настроек (рекомендуется)

Добавьте в ваш `settings.json`:

```json
{
  "webSearch": {
    "provider": [
      { "type": "dashscope" },
      { "type": "tavily", "apiKey": "tvly-xxxxx" },
      {
        "type": "google",
        "apiKey": "your-google-api-key",
        "searchEngineId": "your-search-engine-id"
      }
    ],
    "default": "dashscope"
  }
}
```

**Примечания:**

- DashScope не требует ключа API (официальный бесплатный сервис)
- **Пользователи Qwen OAuth:** DashScope автоматически добавляется в список провайдеров, даже если он явно не настроен
- Настройте дополнительные провайдеры (Tavily, Google), если вы хотите использовать их вместе с DashScope
- Установите `default`, чтобы указать, какой провайдер использовать по умолчанию (если не установлен, приоритетный порядок: Tavily > Google > DashScope)

### Метод 2: Переменные окружения

Установите переменные окружения в вашем shell или файле `.env`:

```bash

# Tavily
export TAVILY_API_KEY="tvly-xxxxx"```

# Google
export GOOGLE_API_KEY="your-api-key"
export GOOGLE_SEARCH_ENGINE_ID="your-engine-id"
```

### Метод 3: Аргументы командной строки

Передавайте ключи API при запуске Qwen Code:

```bash

# Tavily
qwen --tavily-api-key tvly-xxxxx

# Google
qwen --google-api-key your-key --google-search-engine-id your-id

# Указать провайдера по умолчанию
qwen --web-search-default tavily
```

### Обратная совместимость (Устарело)

⚠️ **УСТАРЕЛО:** Устаревшая конфигурация `tavilyApiKey` все еще поддерживается для обратной совместимости, но является устаревшей:

```json
{
  "advanced": {
    "tavilyApiKey": "tvly-xxxxx" // ⚠️ Устарело
  }
}
```

**Важно:** Эта конфигурация устарела и будет удалена в будущей версии. Пожалуйста, перейдите на новый формат конфигурации `webSearch`, показанный выше. Старая конфигурация автоматически настроит Tavily как провайдера, но мы настоятельно рекомендуем обновить вашу конфигурацию.

## Отключение веб-поиска

Если вы хотите отключить функцию веб-поиска, вы можете исключить инструмент `web_search` в вашем файле `settings.json`:

```json
{
  "tools": {
    "exclude": ["web_search"]
  }
}
```

**Примечание:** Для применения этого параметра требуется перезапуск Qwen Code. После отключения инструмент `web_search` будет недоступен для модели, даже если поставщики веб-поиска настроены.

## Примеры использования

### Базовый поиск (с использованием поставщика по умолчанию)

```
web_search(query="последние достижения в области ИИ")
```

### Поиск с указанным поставщиком

```
web_search(query="последние достижения в области ИИ", provider="tavily")
```

### Примеры из реального мира

```
web_search(query="погода в Сан-Франциско сегодня")
web_search(query="последняя версия Node.js LTS", provider="google")
web_search(query="лучшие практики для React 19", provider="dashscope")
```

## Детали поставщика

### DashScope (официальный)

- **Стоимость:** Бесплатно
- **Аутентификация:** Автоматически доступна при использовании аутентификации Qwen OAuth
- **Конфигурация:** Ключ API не требуется, автоматически добавляется в список провайдеров для пользователей Qwen OAuth
- **Квота:** 200 запросов/минута, 2000 запросов/день
- **Лучше всего подходит для:** Общих запросов, всегда доступен как резервный вариант для пользователей Qwen OAuth
- **Авторегистрация:** Если вы используете Qwen OAuth, DashScope автоматически добавляется в ваш список провайдеров, даже если вы не настраивали его явно

### Tavily

- **Стоимость:** Требуется ключ API (платный сервис с бесплатным тарифом)
- **Регистрация:** https://tavily.com
- **Особенности:** Высококачественные результаты с ответами, сгенерированными ИИ
- **Лучше всего подходит для:** Исследований, подробных ответов с цитированием источников

### Пользовательский поиск Google

- **Стоимость:** Доступен бесплатный тариф (100 запросов в день)
- **Настройка:**
  1. Включите API пользовательского поиска в консоли Google Cloud
  2. Создайте движок пользовательского поиска на https://programmablesearchengine.google.com
- **Особенности:** Качество поиска от Google
- **Лучше всего подходит для:** Конкретных, фактических запросов

## Важные замечания

- **Формат ответа:** Возвращает краткий ответ с нумерованными ссылками на источники
- **Цитирование:** Ссылки на источники добавляются в виде нумерованного списка: [1], [2] и т. д.
- **Несколько провайдеров:** Если один провайдер недоступен, укажите другой вручную с помощью параметра `provider`
- **Доступность DashScope:** Автоматически доступен для пользователей Qwen OAuth, настройка не требуется
- **Выбор провайдера по умолчанию:** Система автоматически выбирает провайдера по умолчанию на основе доступности:
  1. Ваша явная конфигурация `default` (наивысший приоритет)
  2. Аргумент командной строки `--web-search-default`
  3. Первый доступный провайдер по приоритету: Tavily > Google > DashScope

## Устранение неполадок

**Инструмент недоступен?**

- **Для пользователей Qwen OAuth:** Инструмент автоматически регистрируется у провайдера DashScope, настройка не требуется
- **Для других типов аутентификации:** Убедитесь, что настроен как минимум один провайдер (Tavily или Google)
- Для Tavily/Google: Проверьте правильность ваших ключей API

**Ошибки конкретного провайдера?**

- Используйте параметр `provider`, чтобы попробовать другого поискового провайдера
- Проверьте ваши квоты и лимиты запросов к API
- Убедитесь, что ключи API правильно заданы в конфигурации

**Нужна помощь?**

- Проверьте вашу конфигурацию: Запустите `qwen` и используйте диалог настроек
- Посмотрите текущие настройки в `~/.qwen-code/settings.json` (macOS/Linux) или `%USERPROFILE%\.qwen-code\settings.json` (Windows)