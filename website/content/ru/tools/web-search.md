# Инструмент веб-поиска (`web_search`)

В этом документе описан инструмент `web_search` для выполнения поиска в интернете с использованием нескольких провайдеров.

## Описание

Используйте `web_search`, чтобы выполнить поиск в интернете и получить информацию из сети. Инструмент поддерживает несколько поисковых провайдеров и возвращает краткий ответ с указанием источников, если они доступны.

### Поддерживаемые провайдеры

1. **DashScope** (официальный, бесплатный) — автоматически доступен для пользователей Qwen OAuth (200 запросов/минута, 2000 запросов/день)
2. **Tavily** — высококачественный поисковый API со встроенной генерацией ответов
3. **Google Custom Search** — JSON API пользовательского поиска Google

### Аргументы

`web_search` принимает два аргумента:

- `query` (string, обязательный): Поисковый запрос
- `provider` (string, опциональный): Конкретный провайдер для использования ("dashscope", "tavily", "google")
  - Если не указан, используется провайдер по умолчанию из конфигурации

## Конфигурация

### Метод 1: Файл настроек (рекомендуется)

Добавьте в ваш `settings.json`:

```json
{
  "webSearch": {
    "provider": [
      { "type": "dashscope" },
      { "type": "tavily", "apiKey": "tvly-xxxxx" },
      {
        "type": "google",
        "apiKey": "your-google-api-key",
        "searchEngineId": "your-search-engine-id"
      }
    ],
    "default": "dashscope"
  }
}
```

**Примечания:**

- DashScope не требует API ключа (официальный бесплатный сервис)
- **Для пользователей Qwen OAuth:** DashScope автоматически добавляется в список провайдеров, даже если он явно не указан в конфигурации
- Настройте дополнительные провайдеры (Tavily, Google), если хотите использовать их вместе с DashScope
- Установите значение `default`, чтобы указать, какой провайдер использовать по умолчанию (если не задано, приоритет такой: Tavily > Google > DashScope)

### Метод 2: Переменные окружения

Установите переменные окружения в вашем shell или файле `.env`:

```bash

# Tavily
export TAVILY_API_KEY="tvly-xxxxx"```

```markdown
# Google
export GOOGLE_API_KEY="your-api-key"
export GOOGLE_SEARCH_ENGINE_ID="your-engine-id"
```

### Метод 3: Аргументы командной строки

Передавайте API ключи при запуске Qwen Code:

```bash

# Tavily
qwen --tavily-api-key tvly-xxxxx

# Google
qwen --google-api-key your-key --google-search-engine-id your-id

# Указать провайдера по умолчанию
qwen --web-search-default tavily
```

### Обратная совместимость (Устарело)

⚠️ **УСТАРЕЛО:** Старая конфигурация `tavilyApiKey` всё ещё поддерживается для обратной совместимости, но является устаревшей:

```json
{
  "advanced": {
    "tavilyApiKey": "tvly-xxxxx" // ⚠️ Устарело
  }
}
```

**Важно:** Эта конфигурация устарела и будет удалена в будущих версиях. Пожалуйста, перейдите на новый формат конфигурации `webSearch`, показанный выше. Старая конфигурация автоматически настроит Tavily как провайдера, но мы настоятельно рекомендуем обновить вашу конфигурацию.
```

## Отключение веб-поиска

Если вы хотите отключить функциональность веб-поиска, вы можете исключить инструмент `web_search` в вашем `settings.json`:

```json
{
  "tools": {
    "exclude": ["web_search"]
  }
}
```

**Примечание:** Для применения этого параметра требуется перезапуск Qwen Code. После отключения инструмент `web_search` будет недоступен для модели, даже если поставщики веб-поиска настроены.

## Примеры использования

### Базовый поиск (с использованием провайдера по умолчанию)

```
web_search(query="latest advancements in AI")
```

### Поиск с указанным провайдером

```
web_search(query="latest advancements in AI", provider="tavily")
```

### Реальные примеры

```
web_search(query="weather in San Francisco today")
web_search(query="latest Node.js LTS version", provider="google")
web_search(query="best practices for React 19", provider="dashscope")
```

## Информация о провайдерах

### DashScope (официальный)

- **Стоимость:** Бесплатно
- **Аутентификация:** Доступен автоматически при использовании Qwen OAuth аутентификации
- **Конфигурация:** API key не требуется, автоматически добавляется в список провайдеров для пользователей Qwen OAuth
- **Квота:** 200 запросов/минута, 2000 запросов/день
- **Лучше всего подходит для:** Общих запросов, всегда доступен как резервный вариант для пользователей Qwen OAuth
- **Авторегистрация:** Если вы используете Qwen OAuth, DashScope автоматически добавляется в ваш список провайдеров, даже если вы не настраивали его явно

### Tavily

- **Стоимость:** Требуется API key (платный сервис с бесплатным тарифом)
- **Регистрация:** https://tavily.com
- **Возможности:** Высококачественные результаты с AI-генерированными ответами
- **Лучше всего подходит для:** Исследований, подробных ответов с цитированием источников

### Google Custom Search

- **Стоимость:** Доступен бесплатный тариф (100 запросов/день)
- **Настройка:**
  1. Включите Custom Search API в консоли Google Cloud
  2. Создайте Custom Search Engine на https://programmablesearchengine.google.com
- **Особенности:** Качество поиска от Google
- **Лучше всего подходит для:** Конкретных, фактических запросов

## Важные замечания

- **Формат ответа:** Возвращает краткий ответ с нумерованными ссылками на источники
- **Цитирование:** Ссылки на источники добавляются в виде нумерованного списка: [1], [2] и т. д.
- **Несколько провайдеров:** Если один провайдер недоступен, укажите другой вручную с помощью параметра `provider`
- **Доступность DashScope:** Автоматически доступен для пользователей Qwen OAuth, дополнительная настройка не требуется
- **Выбор провайдера по умолчанию:** Система автоматически выбирает провайдера по умолчанию на основе доступности:
  1. Ваша явная конфигурация `default` (наивысший приоритет)
  2. Аргумент CLI `--web-search-default`
  3. Первый доступный провайдер по приоритету: Tavily > Google > DashScope

## Устранение неполадок

**Инструмент недоступен?**

- **Для пользователей Qwen OAuth:** Инструмент автоматически регистрируется у провайдера DashScope, настройка не требуется
- **Для других типов аутентификации:** Убедитесь, что хотя бы один провайдер (Tavily или Google) сконфигурирован
- Для Tavily/Google: Проверьте правильность ваших API ключей

**Ошибки конкретного провайдера?**

- Используйте параметр `provider`, чтобы попробовать другой поисковый провайдер
- Проверьте ваши квоты и лимиты запросов к API
- Убедитесь, что API ключи правильно заданы в конфигурации

**Нужна помощь?**

- Проверьте вашу конфигурацию: Запустите `qwen` и используйте диалог настроек
- Посмотрите текущие настройки в файле `~/.qwen-code/settings.json` (macOS/Linux) или `%USERPROFILE%\.qwen-code\settings.json` (Windows)