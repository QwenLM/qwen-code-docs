# Настройка аутентификации

Qwen Code поддерживает два основных метода аутентификации для доступа к AI-моделям. Выберите подходящий вариант в зависимости от вашего сценария использования:

1.  **Qwen OAuth (рекомендуется):**
    - Используйте эту опцию для входа через ваш аккаунт на qwen.ai.
    - При первом запуске Qwen Code перенаправит вас на страницу аутентификации qwen.ai. После успешной авторизации учетные данные будут сохранены локально, и веб-вход можно будет пропустить при последующих запусках.
    - **Требования:**
      - Действующий аккаунт на qwen.ai
      - Интернет-соединение для первоначальной аутентификации
    - **Преимущества:**
      - Бесшовный доступ к моделям Qwen
      - Автоматическое обновление учетных данных
      - Не требуется ручное управление API key

    **Начало работы:**

    ```bash
    # Запустите Qwen Code и пройдите процесс OAuth
    qwen
    ```

    CLI автоматически откроет ваш браузер и проведет через процесс аутентификации.

    **Для пользователей, которые проходят аутентификацию через аккаунт qwen.ai:**

    **Квоты:**
    - 60 запросов в минуту
    - 2000 запросов в день
    - Расход токенов не учитывается

    **Стоимость:** Бесплатно

    **Примечания:** Конкретные квоты для разных моделей не указаны; возможен fallback моделей для сохранения качества общего пользовательского опыта.

2.  **<a id="openai-api"></a>OpenAI-совместимый API:**
    - Используйте API key от OpenAI или других совместимых провайдеров.
    - Этот метод позволяет использовать различные AI-модели через API key.

    **Способы конфигурации:**

    a) **Переменные окружения:**

    ```bash
    export OPENAI_API_KEY="your_api_key_here"
    export OPENAI_BASE_URL="your_api_endpoint"  # Опционально
    export OPENAI_MODEL="your_model_choice"     # Опционально
    ```

    b) **Файл `.env` проекта:**
    Создайте файл `.env` в корне вашего проекта:

    ```env
    OPENAI_API_KEY=your_api_key_here
    OPENAI_BASE_URL=your_api_endpoint
    OPENAI_MODEL=your_model_choice
    ```

    **Поддерживаемые провайдеры:**
    - OpenAI (https://platform.openai.com/api-keys)
    - Alibaba Cloud Bailian
    - ModelScope
    - OpenRouter
    - Azure OpenAI
    - Любой OpenAI-совместимый API

## Переключение методов аутентификации

Чтобы переключаться между методами аутентификации во время сессии, используйте команду `/auth` в интерфейсе CLI:

```bash

# Внутри CLI введите:
/auth
```

Это позволит вам перенастроить метод аутентификации без перезапуска приложения.

### Сохранение переменных окружения с помощью файлов `.env`

Вы можете создать файл **`.qwen/.env`** в директории проекта или в домашней директории. Создание обычного файла **`.env`** также работает, но рекомендуется использовать `.qwen/.env`, чтобы изолировать переменные Qwen Code от других инструментов.

**Важно:** Некоторые переменные окружения (например, `DEBUG` и `DEBUG_MODE`) автоматически исключаются из файлов `.env` проекта, чтобы не мешать работе qwen-code. Используйте файлы `.qwen/.env` для переменных, специфичных для qwen-code.

Qwen Code автоматически загружает переменные окружения из **первого** найденного файла `.env`, используя следующий порядок поиска:

1. Начиная с **текущей директории**, движется вверх к `/`, для каждой директории проверяются:
   1. `.qwen/.env`
   2. `.env`
2. Если файл не найден, происходит fallback к вашей **домашней директории**:
   - `~/.qwen/.env`
   - `~/.env`

> **Важно:** Поиск останавливается на **первом** найденном файле — переменные **не объединяются** из нескольких файлов.

#### Примеры

**Переопределения на уровне проекта** (имеют приоритет, когда вы находитесь внутри проекта):

```bash
mkdir -p .qwen
cat >> .qwen/.env <<'EOF'
OPENAI_API_KEY="your-api-key"
OPENAI_BASE_URL="https://api-inference.modelscope.cn/v1"
OPENAI_MODEL="Qwen/Qwen3-Coder-480B-A35B-Instruct"
EOF
```

**Пользовательские настройки** (доступны в каждом каталоге):

```bash
mkdir -p ~/.qwen
cat >> ~/.qwen/.env <<'EOF'
OPENAI_API_KEY="your-api-key"
OPENAI_BASE_URL="https://dashscope.aliyuncs.com/compatible-mode/v1"
OPENAI_MODEL="qwen3-coder-plus"
EOF
```

## Режим без интерактивности / Headless-среды

При запуске Qwen Code в среде без интерактивности вы не можете использовать стандартный OAuth-флоу для входа.  
Вместо этого необходимо настроить аутентификацию с помощью переменных окружения.

CLI автоматически определит, что он запущен в неинтерактивном терминале, и будет использовать  
метод, совместимый с OpenAI API, если он настроен:

1.  **OpenAI-Compatible API:**
    - Установите переменную окружения `OPENAI_API_KEY`.
    - При необходимости укажите `OPENAI_BASE_URL` и `OPENAI_MODEL` для кастомных endpoint'ов.
    - CLI будет использовать эти учетные данные для аутентификации у провайдера API.

**Пример для headless-сред:**

```bash
export OPENAI_API_KEY="your-api-key"
export OPENAI_BASE_URL="https://api-inference.modelscope.cn/v1"
export OPENAI_MODEL="Qwen/Qwen3-Coder-480B-A35B-Instruct"

# Запуск Qwen Code
qwen
```

Если API-ключ не задан в неинтерактивной сессии, CLI завершит работу с ошибкой, предложив настроить аутентификацию.