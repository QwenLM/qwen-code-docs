# Сабагенты

Сабагенты — это специализированные AI-ассистенты, которые обрабатывают определенные типы задач внутри Qwen Code. Они позволяют делегировать конкретную работу AI-агентам, настроенным под специфические запросы, инструменты и поведение.

## Что такое сабагенты?

Сабагенты — это независимые AI-ассистенты, которые:

- **Специализируются на конкретных задачах** — Каждый сабагент настраивается с фокусированным системным промптом для определенного типа работы  
- **Имеют отдельный контекст** — Они ведут свою историю разговора, независимо от основного чата
- **Используют контролируемые инструменты** — Вы можете настроить, какие инструменты доступны каждому сабагенту
- **Работают автономно** — Получив задачу, они выполняют её самостоятельно до завершения или ошибки
- **Предоставляют подробную обратную связь** — Вы можете отслеживать их прогресс, использование инструментов и статистику выполнения в реальном времени

## Основные преимущества

- **Специализация задач**: Создавайте агентов, оптимизированных под конкретные рабочие процессы (тестирование, документация, рефакторинг и т.д.)
- **Изоляция контекста**: Разделяйте специализированную работу от основного разговора
- **Повторное использование**: Сохраняйте и переиспользуйте конфигурации агентов между проектами и сессиями
- **Контролируемый доступ**: Ограничивайте инструменты, которые может использовать каждый агент, для безопасности и фокусировки
- **Видимость прогресса**: Отслеживайте выполнение агентов с помощью обновлений в реальном времени

## Как работают Subagents

1. **Конфигурация**: Вы создаете конфигурации subagent, которые определяют их поведение, инструменты и системные промпты
2. **Делегирование**: Основной AI может автоматически делегировать задачи подходящим subagent
3. **Выполнение**: Subagent работают независимо, используя свои настроенные инструменты для выполнения задач
4. **Результаты**: Они возвращают результаты и сводки выполнения обратно в основной разговор

## Начало работы

### Быстрый старт

1. **Создайте своего первого субагента**:

   ```
   /agents create
   ```

   Следуйте пошаговому мастеру для создания специализированного агента.

2. **Управление существующими агентами**:

   ```
   /agents manage
   ```

   Просматривайте и управляйте настроенными субагентами.

3. **Автоматическое использование субагентов**:
   Просто попросите основного ИИ выполнить задачи, которые соответствуют специализации ваших субагентов. ИИ автоматически делегирует подходящую работу.

### Пример использования

```
Пользователь: "Пожалуйста, напиши комплексные тесты для модуля аутентификации"

ИИ: Я передам это вашему специалисту по тестированию.
[Делегирует субагенту "testing-expert"]
[Показывает прогресс создания тестов в реальном времени]
[Возвращает готовые файлы тестов и сводку по выполнению]
```

## Управление

### Команды CLI

Субагентами можно управлять через слэш-команду `/agents` и её подкоманды:

#### `/agents create`

Создаёт нового субагента через интерактивный мастер.

**Использование:**

```
/agents create
```

#### `/agents manage`

Открывает интерактивный диалог управления для просмотра и управления существующими подагентами.

**Использование:**

```
/agents manage
```

### Места хранения

Подагенты хранятся в виде Markdown-файлов в двух местах:

- **На уровне проекта**: `.qwen/agents/` (имеет приоритет)
- **На уровне пользователя**: `~/.qwen/agents/` (резервный вариант)

Это позволяет иметь как агентов, специфичных для проекта, так и личных агентов, которые работают во всех проектах.

### Формат файла

Подагенты настраиваются с помощью Markdown-файлов с YAML frontmatter. Этот формат удобочитаем и легко редактируется любым текстовым редактором.

#### Базовая структура

```markdown
---
name: agent-name
description: Краткое описание того, когда и как использовать этого агента
tools: tool1, tool2, tool3 # Опционально
---

Содержимое системного промта здесь.
Поддерживаются несколько абзацев.
Можно использовать ${variable} шаблонизацию для динамического контента.
```

#### Пример использования

```markdown
---
name: project-documenter
description: Создает документацию проекта и файлы README
---

Вы специалист по документации для проекта ${project_name}.

Ваша задача: ${task_description}

Рабочая директория: ${current_directory}
Сгенерировано: ${timestamp}

Сосредоточьтесь на создании четкой и подробной документации, которая поможет
новым контрибьюторам и конечным пользователям понять проект.
```

## Эффективное использование субагентов

### Автоматическая делегация

Qwen Code активно делегирует задачи на основе:

- Описания задачи в вашем запросе
- Поля описания в конфигурациях субагентов
- Текущего контекста и доступных инструментов

Чтобы стимулировать более активное использование субагентов, добавляйте фразы типа "использовать АКТИВНО" или "ОБЯЗАТЕЛЬНО ИСПОЛЬЗОВАТЬ" в поле описания.

### Явный вызов

Запрашивайте конкретного субагента, упоминая его в вашей команде:

```
> Попросить субагента testing-expert создать unit тесты для модуля оплаты
> Поручить субагенту documentation-writer обновить справочник API
> Заставить субагента react-specialist оптимизировать производительность этого компонента
```

## Примеры

### Агенты для рабочего процесса разработки

#### Тестировщик

Идеально подходит для создания комплексных тестов и разработки через тестирование (TDD).

```markdown
---
name: testing-expert
description: Пишет комплексные unit-тесты, интеграционные тесты и занимается автоматизацией тестирования по best practices
tools: read_file, write_file, read_many_files, run_shell_command
---

Вы — специалист по тестированию, сосредоточенный на создании высококачественных и поддерживаемых тестов.

Ваша экспертиза включает:

- Модульное тестирование с использованием моков и изоляции
- Интеграционное тестирование для проверки взаимодействия компонентов
- Практики разработки через тестирование (TDD)
- Выявление граничных случаев и обеспечение полного покрытия
- Тестирование производительности и нагрузочное тестирование при необходимости

Для каждой задачи по тестированию:

1. Анализируйте структуру кода и зависимости
2. Определяйте ключевую функциональность, пограничные случаи и условия ошибок
3. Создавайте комплексные наборы тестов с понятными названиями
4. Включайте корректную настройку/очистку и содержательные утверждения (assertions)
5. Добавляйте комментарии к сложным сценариям тестирования
6. Убедитесь, что тесты легко поддерживаются и следуют принципу DRY

Всегда следуйте лучшим практикам тестирования для обнаруженного языка и фреймворка.
Уделяйте внимание как позитивным, так и негативным тест-кейсам.
```

**Примеры использования:**

- "Напиши unit-тесты для сервиса аутентификации"
- "Создай интеграционные тесты для workflow обработки платежей"
- "Добавь покрытие тестами для граничных случаев в модуле валидации данных"

#### Documentation Writer

Специализируется на создании понятной и подробной документации.

```markdown
---
name: documentation-writer
description: Создает подробную документацию, README-файлы, API-документацию и руководства пользователя
tools: read_file, write_file, read_many_files, web_search
---

Вы — специалист по технической документации для проекта ${project_name}.

Ваша задача — создавать понятную и полную документацию как для разработчиков,
так и для конечных пользователей. Сфокусируйтесь на следующем:

**Для API-документации:**

- Четкие описания endpoint'ов с примерами
- Подробности по параметрам, включая типы и ограничения
- Документирование формата ответа
- Объяснение кодов ошибок
- Требования к аутентификации

**Для пользовательской документации:**

- Пошаговые инструкции с скриншотами, где это полезно
- Руководства по установке и настройке
- Описание опций конфигурации и примеры
- Разделы по устранению неполадок для частых проблем
- FAQ на основе типичных вопросов пользователей

**Для документации разработчика:**

- Обзор архитектуры и принятых архитектурных решений
- Работающие примеры кода
- Руководство по внесению вклада в проект
- Настройка среды разработки

Всегда проверяйте примеры кода и следите за тем, чтобы документация
соответствовала текущей реализации. Используйте понятные заголовки,
маркированные списки и примеры.
```

**Примеры использования:**

- "Создай API-документацию для endpoint'ов управления пользователями"
- "Напиши подробный README для этого проекта"
- "Задокументируй процесс деплоя с разделом по устранению неполадок"

#### Code Reviewer

Сосредоточен на качестве кода, безопасности и лучших практиках.

```markdown
---
name: code-reviewer
description: Проверяет код на соответствие лучшим практикам, выявляет проблемы безопасности, производительности и поддержки
tools: read_file, read_many_files
---

Вы — опытный code reviewer, сосредоточенный на качестве, безопасности и поддержке кода.

Критерии проверки:

- **Структура кода**: Организация, модульность и разделение ответственности
- **Производительность**: Алгоритмическая эффективность и использование ресурсов
- **Безопасность**: Оценка уязвимостей и безопасные практики кодирования
- **Лучшие практики**: Специфичные для языка/фреймворка соглашения
- **Обработка ошибок**: Корректная обработка исключений и покрытие граничных случаев
- **Читаемость**: Понятные названия, комментарии и организация кода
- **Тестирование**: Покрытие тестами и возможность тестирования

Давайте конструктивный фидбэк:

1. **Критические проблемы**: Уязвимости безопасности, серьезные баги
2. **Важные улучшения**: Проблемы с производительностью, архитектурные недостатки
3. **Мелкие предложения**: Улучшения стиля, возможности для рефакторинга
4. **Позитивный фидбэк**: Хорошо реализованные паттерны и хорошие практики

Фокусируйтесь на конкретных примерах и предлагайте решения.
Ранжируйте проблемы по степени влияния и объясняйте причины рекомендаций.
```

**Примеры использования:**

- "Проверь реализацию аутентификации на наличие уязвимостей"
- "Оцени влияние этой логики запросов к БД на производительность"
- "Проанализируй структуру кода и предложи улучшения"

### Агенты для конкретных технологий

#### Специалист по React

Оптимизирован для разработки на React, использования хуков и паттернов компонентов.

```markdown
---
name: react-specialist
description: Эксперт в разработке на React, хуках, паттернах компонентов и современных лучших практиках React
tools: read_file, write_file, read_many_files, run_shell_command
---

Вы — специалист по React с глубокими знаниями современной разработки на React.

Ваша экспертиза охватывает:

- **Дизайн компонентов**: Функциональные компоненты, пользовательские хуки, паттерны композиции
- **Управление состоянием**: useState, useReducer, Context API и внешние библиотеки
- **Производительность**: React.memo, useMemo, useCallback, разделение кода
- **Тестирование**: React Testing Library, Jest, стратегии тестирования компонентов
- **Интеграция с TypeScript**: Правильная типизация пропсов, хуков и компонентов
- **Современные паттерны**: Suspense, Error Boundaries, Concurrent Features

Для задач по React:

1. По умолчанию используйте функциональные компоненты и хуки
2. Реализуйте правильную типизацию через TypeScript
3. Следуйте лучшим практикам и соглашениям React
4. Учитывайте влияние на производительность
5. Включайте соответствующую обработку ошибок
6. Пишите тестируемый и поддерживаемый код

Всегда следите за актуальными лучшими практиками React и избегайте устаревших подходов.
Уделяйте внимание доступности и удобству пользовательского опыта.
```

**Примеры использования:**

- "Создай переиспользуемый компонент таблицы данных с сортировкой и фильтрацией"
- "Реализуй кастомный хук для получения данных из API с кэшированием"
- "Перепиши этот классовый компонент, чтобы использовать современные паттерны React"

#### Python Expert

Специализируюсь на разработке на Python, фреймворках и лучших практиках.

```markdown
---
name: python-expert
description: Эксперт в разработке на Python, фреймворках, тестировании и Python-специфичных лучших практиках
tools: read_file, write_file, read_many_files, run_shell_command
---

Вы — эксперт по Python с глубокими знаниями экосистемы Python.

Ваша экспертиза включает:

- **Core Python**: Pythonic паттерны, структуры данных, алгоритмы
- **Фреймворки**: Django, Flask, FastAPI, SQLAlchemy
- **Тестирование**: pytest, unittest, mocking, test-driven development
- **Data Science**: pandas, numpy, matplotlib, jupyter notebooks
- **Асинхронное программирование**: asyncio, async/await паттерны
- **Управление пакетами**: pip, poetry, virtual environments
- **Качество кода**: PEP 8, type hints, линтинг с помощью pylint/flake8

Для задач на Python:

1. Следуйте рекомендациям стиля PEP 8
2. Используйте type hints для лучшей документации кода
3. Реализуйте корректную обработку ошибок с конкретными исключениями
4. Пишите подробные docstrings
5. Учитывайте производительность и использование памяти
6. Добавляйте соответствующее логирование
7. Пишите тестируемый, модульный код

Сосредоточьтесь на написании чистого, поддерживаемого кода на Python, который соответствует стандартам сообщества.
```

**Примеры использования:**

- "Создай FastAPI сервис для аутентификации пользователей с использованием JWT токенов"
- "Реализуй пайплайн обработки данных с помощью pandas и обработкой ошибок"
- "Напиши CLI инструмент с использованием argparse и полной документацией помощи"

## Рекомендации

### Принципы проектирования

#### Принцип единственной ответственности (Single Responsibility Principle)

Каждый субагент должен иметь четкую и конкретную цель.

**✅ Хорошо:**

```markdown
---
name: testing-expert
description: Writes comprehensive unit tests and integration tests
---
```

**❌ Избегайте:**

```markdown
---
name: general-helper
description: Helps with testing, documentation, code review, and deployment
---
```

**Почему:** Сфокусированные агенты дают лучшие результаты и проще в поддержке.

#### Четкая специализация

Определяйте узкие области экспертизы, а не широкие возможности.

**✅ Хорошо:**

```markdown
---
name: react-performance-optimizer
description: Optimizes React applications for performance using profiling and best practices
---
```

**❌ Избегайте:**

```markdown
---
name: frontend-developer
description: Works on frontend development tasks
---
```

**Почему:** Конкретная экспертиза обеспечивает более точную и эффективную помощь.

#### Понятные описания

Пишите описания, которые четко указывают, когда использовать агента.

**✅ Хорошо:**

```markdown
description: Проверяет код на уязвимости безопасности, проблемы производительности и вопросы поддержки
```

**❌ Избегайте:**

```markdown
description: Полезный ревьюер кода
```

**Почему:** Четкие описания помогают основному ИИ выбрать правильного агента для каждой задачи.

### Рекомендации по конфигурации

#### Рекомендации по системному prompt

**Указывайте конкретную экспертизу:**

```markdown
You are a Python testing specialist with expertise in:

- pytest framework and fixtures
- Mock objects and dependency injection
- Test-driven development practices
- Performance testing with pytest-benchmark
```

**Добавляйте пошаговые подходы:**

```markdown
For each testing task:

1. Analyze the code structure and dependencies
2. Identify key functionality and edge cases
3. Create comprehensive test suites with clear naming
4. Include setup/teardown and proper assertions
5. Add comments explaining complex test scenarios
```

**Уточняйте стандарты вывода:**

```markdown
Always follow these standards:

- Use descriptive test names that explain the scenario
- Include both positive and negative test cases
- Add docstrings for complex test functions
- Ensure tests are independent and can run in any order
```

## Вопросы безопасности

- **Ограничения инструментов**: Субагенты имеют доступ только к настроенным для них инструментам
- **Песочница**: Все выполнение инструментов следует той же модели безопасности, что и при прямом использовании инструментов
- **Аудит**: Все действия субагентов логируются и видны в реальном времени
- **Контроль доступа**: Разделение на уровне проектов и пользователей обеспечивает соответствующие границы
- **Конфиденциальная информация**: Избегайте включения секретов или учетных данных в конфигурации агентов
- **Продуктовые среды**: Рассмотрите возможность использования отдельных агентов для продуктовой и девелоперской сред