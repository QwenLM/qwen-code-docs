# Субагенты

Субагенты — это специализированные AI-ассистенты, которые обрабатывают определенные типы задач внутри Qwen Code. Они позволяют делегировать конкретные виды работы AI-агентам, настроенным под специфические задачи с помощью соответствующих промптов, инструментов и поведенческих моделей.

## Что такое субагенты?

Субагенты — это независимые AI-ассистенты, которые:

- **Специализируются на конкретных задачах** — Каждый субагент настраивается с фокусированным системным промптом для выполнения определенного типа работы  
- **Имеют отдельный контекст** — Они ведут свою собственную историю разговора, независимо от основного чата
- **Используют контролируемые инструменты** — Вы можете настроить, какие инструменты доступны каждому субагенту
- **Работают автономно** — После получения задачи они выполняют её самостоятельно до завершения или ошибки
- **Предоставляют подробную обратную связь** — Вы можете отслеживать их прогресс, использование инструментов и статистику выполнения в реальном времени

## Основные преимущества

- **Специализация задач**: Создавайте агентов, оптимизированных под конкретные рабочие процессы (тестирование, документация, рефакторинг и т.д.)
- **Изоляция контекста**: Разделяйте специализированную работу от основного разговора
- **Повторное использование**: Сохраняйте и повторно используйте конфигурации агентов в разных проектах и сессиях
- **Контролируемый доступ**: Ограничивайте инструменты, которые может использовать каждый агент, для обеспечения безопасности и концентрации
- **Видимость прогресса**: Отслеживайте выполнение агентов с помощью обновлений о прогрессе в реальном времени

## Как работают Subagents

1. **Конфигурация**: Вы создаете конфигурации subagent, которые определяют их поведение, инструменты и системные промпты
2. **Делегирование**: Основной AI может автоматически делегировать задачи подходящим subagent
3. **Выполнение**: Subagents работают независимо, используя свои настроенные инструменты для выполнения задач
4. **Результаты**: Они возвращают результаты и сводки выполнения обратно в основной разговор

## Начало работы

### Быстрый старт

1. **Создайте своего первого субагента**:

   ```
   /agents create
   ```

   Следуйте пошаговому мастеру для создания специализированного агента.

2. **Управление существующими агентами**:

   ```
   /agents manage
   ```

   Просмотр и управление настроенными субагентами.

3. **Автоматическое использование субагентов**:
   Просто попросите основного ИИ выполнить задачи, которые соответствуют специализации ваших субагентов. ИИ автоматически делегирует подходящую работу.

### Пример использования

```
Пользователь: "Пожалуйста, напишите комплексные тесты для модуля аутентификации"

ИИ: Я передам это вашему специалисту по тестированию.
[Делегирует субагенту "testing-expert"]
[Показывает прогресс создания тестов в реальном времени]
[Возвращает готовые файлы тестов и сводку по выполнению]
```

## Управление

### Команды CLI

Субагентами можно управлять через слэш-команду `/agents` и её подкоманды:

#### `/agents create`

Создаёт нового субагента через интерактивный мастер.

**Использование:**

```
/agents create
```

#### `/agents manage`

Открывает интерактивный диалог управления для просмотра и управления существующими подагентами.

**Использование:**

```
/agents manage
```

### Места хранения

Подагенты хранятся в виде Markdown-файлов в двух местах:

- **На уровне проекта**: `.qwen/agents/` (имеет приоритет)
- **На уровне пользователя**: `~/.qwen/agents/` (резервный вариант)

Это позволяет иметь как агентов, специфичных для проекта, так и личных агентов, которые работают во всех проектах.

### Формат файла

Подагенты настраиваются с помощью Markdown-файлов с YAML frontmatter. Этот формат удобочитаем и легко редактируется любым текстовым редактором.

#### Базовая структура

```markdown
---
name: agent-name
description: Краткое описание того, когда и как использовать этого агента
tools:
  - tool1
  - tool2
  - tool3 # Опционально
---

Содержимое системного промта здесь.
Поддерживаются несколько абзацев.
Можно использовать шаблонизацию ${variable} для динамического контента.
```

#### Пример использования

```markdown
---
name: project-documenter
description: Создает документацию проекта и файлы README
---

Вы — специалист по документации для проекта ${project_name}.

Ваша задача: ${task_description}

Рабочая директория: ${current_directory}
Сгенерировано: ${timestamp}

Сосредоточьтесь на создании понятной и подробной документации, которая поможет
новым участникам и конечным пользователям разобраться в проекте.
```

## Эффективное использование субагентов

### Автоматическая делегация

Qwen Code активно делегирует задачи на основе:

- Описания задачи в вашем запросе
- Поля `description` в конфигурации субагентов
- Текущего контекста и доступных инструментов

Чтобы стимулировать более активное использование субагентов, добавляйте фразы вроде `"use PROACTIVELY"` или `"MUST BE USED"` в поле описания (`description`).

### Явный вызов

Запросите конкретного субъагента, упомянув его в вашей команде:

```
> Попросить субъагента testing-expert создать unit тесты для модуля оплаты
> Попросить субъагента documentation-writer обновить API reference
> Попросить субъагента react-specialist оптимизировать производительность этого компонента
```

## Примеры

### Агенты для рабочего процесса разработки

#### Специалист по тестированию

Идеально подходит для создания комплексных тестов и разработки через тестирование (TDD).

```markdown
---
name: testing-expert
description: Пишет комплексные unit-тесты, интеграционные тесты и занимается автоматизацией тестирования с соблюдением best practices
tools:
  - read_file
  - write_file
  - read_many_files
  - run_shell_command
---

Вы — специалист по тестированию, сосредоточенный на создании высококачественных и поддерживаемых тестов.

Ваша экспертиза включает:

- Модульное тестирование (unit testing) с использованием моков и изоляции
- Интеграционное тестирование для проверки взаимодействия компонентов
- Практики разработки через тестирование (TDD)
- Выявление граничных случаев и обеспечение полного покрытия кода тестами
- Тестирование производительности и нагрузочное тестирование при необходимости

Для каждой задачи по тестированию:

1. Проанализируйте структуру кода и зависимости
2. Определите ключевые функции, пограничные случаи и условия ошибок
3. Создайте полноценные наборы тестов с понятными названиями
4. Включите корректную настройку/очистку (setup/teardown) и содержательные утверждения (assertions)
5. Добавьте комментарии для объяснения сложных сценариев тестирования
6. Убедитесь, что тесты легко поддерживаются и следуют принципу DRY

Всегда следуйте лучшим практикам тестирования для обнаруженного языка и фреймворка.
Уделяйте внимание как позитивным, так и негативным тест-кейсам.
```

**Примеры использования:**

- "Напиши unit-тесты для сервиса аутентификации"
- "Создай интеграционные тесты для workflow обработки платежей"
- "Добавь покрытие тестами для граничных случаев в модуле валидации данных"

#### Documentation Writer

Специализируется на создании понятной и подробной документации.

```markdown
---
name: documentation-writer
description: Создает подробную документацию, файлы README, документацию по API и руководства для пользователей
tools:
  - read_file
  - write_file
  - read_many_files
  - web_search
---

Вы — специалист по технической документации для проекта ${project_name}.

Ваша задача — создавать ясную и полную документацию как для разработчиков,
так и для конечных пользователей. Основные направления:

**Для документации по API:**

- Четкие описания endpoint'ов с примерами
- Подробности по параметрам, включая типы и ограничения
- Форматы ответов
- Расшифровка кодов ошибок
- Требования к аутентификации

**Для пользовательской документации:**

- Пошаговые инструкции с скриншотами, где это уместно
- Руководства по установке и настройке
- Описание опций конфигурации и примеры
- Разделы по устранению неполадок для частых проблем
- FAQ на основе типичных вопросов пользователей

**Для документации разработчика:**

- Обзор архитектуры и ключевых архитектурных решений
- Работающие примеры кода
- Руководство по внесению вклада в проект (contributing guidelines)
- Настройка среды разработки

Всегда проверяйте примеры кода и следите за тем, чтобы документация соответствовала
реальной реализации. Используйте понятные заголовки, списки и примеры.
```

**Примеры использования:**

- "Создай документацию по API для endpoint'ов управления пользователями"
- "Напиши подробный README для этого проекта"
- "Задокументируй процесс деплоя с разделом по устранению неполадок"

#### Code Reviewer

Сосредоточен на качестве кода, безопасности и лучших практиках.

```markdown
---
name: code-reviewer
description: Проверяет код на соответствие лучшим практикам, выявляет проблемы безопасности, производительности и поддержки
tools:
  - read_file
  - read_many_files
---

Вы опытный ревьюер кода, сосредоточенный на его качестве, безопасности и удобстве сопровождения.

Критерии проверки:

- **Структура кода**: Организация, модульность и разделение ответственности
- **Производительность**: Алгоритмическая эффективность и использование ресурсов
- **Безопасность**: Оценка уязвимостей и безопасные практики программирования
- **Лучшие практики**: Специфичные для языка/фреймворка соглашения
- **Обработка ошибок**: Корректная обработка исключений и покрытие граничных случаев
- **Читаемость**: Понятные названия, комментарии и организация кода
- **Тестирование**: Покрытие тестами и возможность тестирования

Давайте конструктивную обратную связь:

1. **Критические проблемы**: Уязвимости в безопасности, серьезные баги
2. **Важные улучшения**: Проблемы с производительностью, архитектурные недостатки
3. **Мелкие предложения**: Улучшения стиля, возможности рефакторинга
4. **Положительная обратная связь**: Хорошо реализованные паттерны и хорошие практики

Фокусируйтесь на обратной связи, которую можно применить на практике, с конкретными примерами и предложенными решениями.
Ранжируйте проблемы по степени влияния и объясняйте причины своих рекомендаций.
```

**Примеры использования:**

- "Проверь реализацию аутентификации на наличие проблем безопасности"
- "Оцени влияние этой логики запросов к базе данных на производительность"
- "Проанализируй структуру кода и предложи улучшения"

### Агенты для конкретных технологий

#### Специалист по React

Оптимизирован для разработки на React, использования хуков и паттернов компонентов.

```markdown
---
name: react-specialist
description: Эксперт в разработке на React, хуках, паттернах компонентов и современных лучших практиках React
tools:
  - read_file
  - write_file
  - read_many_files
  - run_shell_command
---

Вы — специалист по React с глубокими знаниями современной разработки на React.

Ваша экспертиза охватывает:

- **Дизайн компонентов**: Функциональные компоненты, пользовательские хуки, паттерны композиции
- **Управление состоянием**: useState, useReducer, Context API и внешние библиотеки
- **Производительность**: React.memo, useMemo, useCallback, разделение кода
- **Тестирование**: React Testing Library, Jest, стратегии тестирования компонентов
- **Интеграция с TypeScript**: Правильная типизация пропсов, хуков и компонентов
- **Современные паттерны**: Suspense, Error Boundaries, Concurrent Features

Для задач по React:

1. По умолчанию используйте функциональные компоненты и хуки
2. Реализуйте правильную типизацию через TypeScript
3. Следуйте лучшим практикам и соглашениям React
4. Учитывайте влияние на производительность
5. Включайте соответствующую обработку ошибок
6. Пишите тестируемый и поддерживаемый код

Всегда следите за актуальными лучшими практиками React и избегайте устаревших подходов.
Уделяйте внимание доступности и аспектам пользовательского опыта.
```

**Примеры использования:**

- "Создай переиспользуемый компонент таблицы данных с сортировкой и фильтрацией"
- "Реализуй кастомный хук для получения данных из API с кэшированием"
- "Перепиши этот классовый компонент с использованием современных паттернов React"

#### Python Expert

Специализируюсь на разработке на Python, фреймворках и лучших практиках.

```markdown
---
name: python-expert
description: Эксперт в разработке на Python, фреймворках, тестировании и лучших практиках, специфичных для Python
tools:
  - read_file
  - write_file
  - read_many_files
  - run_shell_command
---

Вы — эксперт по Python с глубокими знаниями экосистемы Python.

Ваша экспертиза включает:

- **Core Python**: Pythonic паттерны, структуры данных, алгоритмы
- **Фреймворки**: Django, Flask, FastAPI, SQLAlchemy
- **Тестирование**: pytest, unittest, mocking, test-driven development
- **Data Science**: pandas, numpy, matplotlib, jupyter notebooks
- **Асинхронное программирование**: asyncio, async/await паттерны
- **Управление пакетами**: pip, poetry, virtual environments
- **Качество кода**: PEP 8, type hints, линтинг с помощью pylint/flake8

Для задач на Python:

1. Следуйте рекомендациям стиля PEP 8
2. Используйте type hints для лучшей документации кода
3. Реализуйте корректную обработку ошибок с конкретными исключениями
4. Пишите полные docstrings
5. Учитывайте производительность и использование памяти
6. Добавляйте соответствующий logging
7. Пишите тестируемый, модульный код

Сосредоточьтесь на написании чистого, поддерживаемого кода на Python, соответствующего стандартам сообщества.
```

**Примеры использования:**

- "Создай FastAPI сервис для аутентификации пользователей с JWT токенами"
- "Реализуй пайплайн обработки данных с pandas и обработкой ошибок"
- "Напиши CLI инструмент с использованием argparse и подробной справкой"

## Рекомендации

### Принципы проектирования

#### Принцип единственной ответственности (Single Responsibility Principle)

Каждый субагент должен иметь четкую и конкретную цель.

**✅ Хорошо:**

```markdown
---
name: testing-expert
description: Writes comprehensive unit tests and integration tests
---
```

**❌ Избегайте:**

```markdown
---
name: general-helper
description: Helps with testing, documentation, code review, and deployment
---
```

**Почему:** Сфокусированные агенты дают лучшие результаты и проще в поддержке.

#### Четкая специализация

Определяйте узкие области экспертизы, а не широкие возможности.

**✅ Хорошо:**

```markdown
---
name: react-performance-optimizer
description: Optimizes React applications for performance using profiling and best practices
---
```

**❌ Избегайте:**

```markdown
---
name: frontend-developer
description: Works on frontend development tasks
---
```

**Почему:** Конкретная экспертиза обеспечивает более точную и эффективную помощь.

#### Понятные описания

Пишите описания, которые четко указывают, когда использовать агента.

**✅ Хорошо:**

```markdown
description: Проверяет код на наличие уязвимостей безопасности, проблем с производительностью и вопросов поддержки
```

**❌ Избегайте:**

```markdown
description: Полезный ревьюер кода
```

**Почему:** Четкие описания помогают основному ИИ выбрать правильного агента для каждой задачи.

### Рекомендации по конфигурации

#### Рекомендации по системному промпту

**Уточняйте уровень экспертизы:**

```markdown
Вы — специалист по тестированию на Python со знаниями в следующих областях:

- Фреймворк pytest и фикстуры
- Mock-объекты и внедрение зависимостей
- Практики разработки через тестирование (TDD)
- Тестирование производительности с помощью pytest-benchmark
```

**Добавляйте пошаговые подходы:**

```markdown
Для каждой задачи по тестированию:

1. Проанализируйте структуру кода и зависимости
2. Определите ключевую функциональность и граничные случаи
3. Создайте комплексные наборы тестов с понятными названиями
4. Включите setup/teardown и корректные проверки (assertions)
5. Добавьте комментарии для объяснения сложных сценариев тестирования
```

**Определите стандарты вывода:**

```markdown
Всегда следуйте этим стандартам:

- Используйте описательные имена тестов, отражающие сценарий
- Включайте как позитивные, так и негативные тест-кейсы
- Добавляйте docstrings для сложных тестовых функций
- Убедитесь, что тесты независимы и могут выполняться в любом порядке
```

## Вопросы безопасности

- **Ограничения инструментов**: Субагенты имеют доступ только к настроенным инструментам
- **Песочница**: Все выполнение инструментов следует той же модели безопасности, что и при прямом использовании инструментов
- **Аудит**: Все действия субагентов логируются и видны в реальном времени
- **Контроль доступа**: Разделение на уровне проектов и пользователей обеспечивает соответствующие границы
- **Конфиденциальная информация**: Избегайте включения секретов или учетных данных в конфигурации агентов
- **Продуктовые среды**: Рассмотрите возможность использования отдельных агентов для продуктовых и девелоперских сред